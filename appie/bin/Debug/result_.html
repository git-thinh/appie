<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title></title><style type="text/css">html * {
    padding: 0;
    margin: 0;
}

body {
    padding: 0 10px 20px;
    margin: 0;
    font-size: 1.5em;
}

h1 {
    text-align: left;
    clear: both;
    padding-bottom: 30px;
    padding-top: 10px;
    font-size: 1.9em;
    line-height: 1.1em;
}


h2, h3, h4, h5, h6 {
    margin: 0px;
    line-height: 1.1em;
}

h2, h3 {
    padding: 15px 0;
    font-size: 1.5em;
}

h4, h5, h6 {
    padding: 20px 0 0 0;
    font-size: 1.1em;
}

audio {
    padding: 10px;
    margin: 0px;
}

article {
    display: inline-block;
    width: 100%;
    padding-bottom: 30px;
}

pre {
    display: inline-block;
    width: auto;
    clear: both;
    margin: 3px 0 7px 0;
    background-color: #eff0f1; /*#fcc*/
    padding: 7px 30px;
    line-height: 1.5em;
    white-space: pre-wrap;
    font-size: 0.7em;
    font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif;
}

code {
    padding: 1px 5px;
    background-color: #eff0f1;
    font-size: 0.7em;
    font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif;
}

div {
    line-height: 1.3em;
}

ul, ol {
    clear: both;
    display: inline-block;
    margin: 0;
    padding: 0 0 15px 40px;
    min-width: 90%;
}

    ul li, ol li {
        display: list-item;
        width: 100%;
        clear: both;
        margin: 0;
        padding: 0 0 5px 0;
    }

        ul li ul, ol li ol {
            padding: 10px 40px;
        }

        ul li div, ul li p, ul li span, ul li i {
            font-style: normal;
            font-size: 1em;
        }

        ul li a {
            font-weight: bold;
        }

p {
    padding: 0;
    margin: 0;
    line-height: 1.7em;
}

a {
    text-decoration: none;
    font-weight: normal;
    color: #07C;
}

    a:visited {
        color: #005999;
    }

    a:hover {
        color: blue;
        text-decoration: underline;
    }


img {
    max-width: 90% !important;
}

/*stackoverflow.com*/

body.stackoverflow .question .comments-list {
    border-top: 3px solid #777;
    margin-top: 30px;
    padding-top: 30px;
}

body.stackoverflow .question .votecell {
    display: none;
}

body.stackoverflow #answers {
    border-top: 3px solid #000;
    margin-top: 30px;
    padding-top: 30px;
    padding-left: 70px;
}

    body.stackoverflow #answers .pager-answers {
        text-align: right;
        padding-bottom: 15px;
    }


    body.stackoverflow #answers .vote {
        text-align: right;
    }

        body.stackoverflow #answers .vote .vote-count-post {
            border: 1px solid #ddd;
            font-size: 0.7em;
            padding: 3px;
            color: #ccc;
        }

    body.stackoverflow #answers ul.comments-list {
        padding-left: 70px;
        padding-top: 20px;
    }

        body.stackoverflow #answers ul.comments-list li.comment .comment-body {
            font-size: 0.8em;
        }

        body.stackoverflow #answers ul.comments-list li.comment .comment-date {
            font-size: 0.7em;
            color: #ccc;
            font-style: normal;
        }

    body.stackoverflow #answers .answer,
    body.stackoverflow #answers .accepted-answer {
        border-bottom: 1px solid #555;
        margin-bottom: 10px;
        padding-bottom: 10px;
    }

/*github.com*/

body.github .file-navigation, body.github .pagehead-actions, body.github .gist-banner, body.github .js-permalink-shortcut, body.github .commit-tease, body.github .repository-lang-stats-graph, body.github .pagehead-actions {
    display: none;
}

body.github ul.numbers-summary li {
    float: left;
    margin-right: 30px;
    width: auto;
    clear: none;
    padding-top: 15px;
}

/*docs.microsoft.com*/

body.microsoft .content-header, body.microsoft #secondary #sidebar-widget-area {
    display: none;
}
body.microsoft a[data-linktype="relative-path"] {
    display: block;
    width: 100%;
}

/*codeproject.com*/

body.codeproject .site-top-menu, body.codeproject .sub-headerbar, body.codeproject .article-wing-left, body.codeproject .article-wing-right, body.codeproject .container-content .article-nav, body.codeproject .site-header, body.codeproject .content-list .content-list-item .thumbnail {
    display: none;
} 
</style></head><body class=caigicunghay>
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<div class="col-xs-12 col-sm-12 col-md-12 top-header-right">
<div class="timer col-md-6 col-xs-12 col-sm-6">
July 8, 2018            </div>
</div>
<div class="wrapper wrapper-site-identity">
<div class="container">
<div class="row">
<div class="col-xs-12 col-sm-12 col-md-4">
<div class="site-branding">
<a href="http://caigicunghay.com/" class="custom-logo-link" rel="home" itemprop="url"><img width="273" height="77" src="http://caigicunghay.com/wp-content/uploads/2017/07/cropped-cropped-logo-2.png" class="custom-logo" alt="" itemprop="logo" /></a>                                                                <p class="site-title"><a href="http://caigicunghay.com/" rel="home"></a></p>
</div>
</div>
</div>
</div>
</div>
<div class="container">
<div class="wrap-inner">
<div class="sec-menu">
<div id="primary-menu" class="primary-menu"><ul>
<li class="page_item page-item-132"><a href="http://caigicunghay.com/blog/">Blog</a></li>
<li class="page_item page-item-2"><a href="http://caigicunghay.com/gioi-thieu/">Giới thiệu</a></li>
<li class="page_item page-item-17 current_page_parent"><a href="http://caigicunghay.com/trang-chu/">Trang chủ</a></li>
</ul></div>
<div class="nav-holder">
<span class="fa fa-bars"></span>
<div id="sec-site-header-menu" class="site-header-menu">
<div class="container">
<div class="row">
<div class="col-xs-12 col-sm-12 col-md-12">
<div id="primary-menu-mobile" class="primary-menu"><ul>
<li class="page_item page-item-132"><a href="http://caigicunghay.com/blog/">Blog</a></li>
<li class="page_item page-item-2"><a href="http://caigicunghay.com/gioi-thieu/">Giới thiệu</a></li>
<li class="page_item page-item-17 current_page_parent"><a href="http://caigicunghay.com/trang-chu/">Trang chủ</a></li>
</ul></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="nav-buttons col-md-1">
<div class="button-list">
<div class="search-holder">
<a class="button-search button-outline" href="#">
<i class="fa fa-search"></i>
</a>
</div>
</div>
</div>
</div>
<div class="search-form-nav" id="top-search">
</div>
</div>
<div class="container">
<div class="wrap-inner">
<div class="row">
<div class="col-xs-12 col-sm-9 col-md-9 top-header-left">
<div class="noticebar">
<span class="notice-title">Latest</span>
<div class="ticker">
<div id="cycle-slideshow-ticker" class="cycle-slideshow"
data-cycle-log="false"
data-cycle-swipe=true
data-cycle-timeout=5000
data-cycle-fx=scrollVert
data-cycle-speed=1000
data-cycle-carousel-fluid=true
data-cycle-carousel-visible=5
data-cycle-pause-on-hover=true
data-cycle-auto-height=container
data-cycle-prev=#slide-prev-notice
data-cycle-next=#slide-next-notice
data-cycle-slides="> div">
<div class="slide-item">
<a href="http://caigicunghay.com/auto-sro_client-phan-mem-auto-train-con-duong-lua/">
<span class="notice-content">Auto SRO_CLIENT phần mềm auto train con đường tơ lụa</span>
</a>
</div>
<div class="slide-item">
<a href="http://caigicunghay.com/quan-ly-thread-pool-trong-c/">
<span class="notice-content">Quản lý Thread Pool trong C#</span>
</a>
</div>
<div class="slide-item">
<a href="http://caigicunghay.com/nhung-dieu-minh-nhan-ra-o-tuoi-17/">
<span class="notice-content">Những điều mình nhận ra ở tuổi 17</span>
</a>
</div>
<div class="slide-item">
<a href="http://caigicunghay.com/lam-nao-de-co-lam-viec-hieu-qua-nhat/">
<span class="notice-content">Làm thế nào để có thể làm việc hiệu quả nhất</span>
</a>
</div>
<div class="slide-item">
<a href="http://caigicunghay.com/cach-cai-thien-su-tu-tin-cua-ban-lau-dai/">
<span class="notice-content">Cách cải thiện sự tự tin của bản thân lâu dài</span>
</a>
</div>
</div>
<div class="cycle-pager" id="slide-pager"></div>
</div>
</div>
</div>
<div class="controls col-md-1 hidden-xs">
<a href="#" id="slide-prev-notice"><i class="fa fa-angle-left"></i></a>
<a href="#" id="slide-next-notice"><i class="fa fa-angle-right"></i></a>
</div>
</div>
</div>
</div>
<section class="wrapper">
<div id="content" class="site-content">
<div id="breadcrumb" class="wrapper wrap-breadcrumb"><div class="container"><div role="navigation" aria-label="Breadcrumbs" class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb"><ul class="trail-items" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item trail-begin"><a href="http://caigicunghay.com" rel="home"><span itemprop="name">Home</span></a></li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item"><a href="http://caigicunghay.com/category/cung-toi-code/"><span itemprop="name">Cùng tôi Code</span></a></li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item trail-end"><span itemprop="name">Quản lý Thread Pool trong C#</span></li></ul></div></div></div>
<div id="primary" class="content-area">
<main id="main" class="site-main" role="main">
<article id="post-633" class="post-633 post type-post status-publish format-standard has-post-thumbnail hentry category-cung-toi-code">
<div class="wrapper page-inner-title">
<div class="container">
<div class="row">
<div class="col-md-12 col-sm-12 col-xs-12">
<div class="inner-banner-overlay">
<h1 class="entry-title">Quản lý Thread Pool trong C#</h1>
<div class="entry-meta entry-inner">
<span class="posted-on">On <a href="http://caigicunghay.com/2018/02/14/" rel="bookmark"><time class="entry-date published updated" datetime="2018-02-14T11:31:50+00:00">February 14, 2018</time></a></span><span class="byline"> By <span class="author vcard"><a class="url fn n" href="http://caigicunghay.com/author/caigicunghay/">Con chó vàng</a></span></span>									</div>
</div>
</div>
</div>
</div>
</div>
<div class="entry-content">
<div class='image-full'><img width="1200" height="621" src="http://caigicunghay.com/wp-content/uploads/2018/02/1200px-Thread_pool.svg_.png" class="attachment-full size-full wp-post-image" alt="" srcset="http://caigicunghay.com/wp-content/uploads/2018/02/1200px-Thread_pool.svg_.png 1200w, http://caigicunghay.com/wp-content/uploads/2018/02/1200px-Thread_pool.svg_-300x155.png 300w, http://caigicunghay.com/wp-content/uploads/2018/02/1200px-Thread_pool.svg_-768x397.png 768w, http://caigicunghay.com/wp-content/uploads/2018/02/1200px-Thread_pool.svg_-1024x530.png 1024w" sizes="(max-width: 1200px) 100vw, 1200px" /></div>
<p>Lớp <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool">Thread Pool</a> cung cấp cho ứng dụng của bạn một nhóm luồng làm việc được quản lý bởi hệ thống, cho phép bạn tập trung vào công việc của ứng dụng hơn việc quản lý luồng, nếu như bạn có các tác vụ nhỏ yêu cầu cần xử lý nền (ví dụ như kiểm tra bản cập nhật mới nhất). Thì quản lý thread pool là một cách đơn giản để tận dụng đa luồng. Ví dụ, bắt đầu với .NET Framework 4, bạn có thể tạo các đối tượng Task và Task <TResult>, thực hiện các tác vụ không đồng bộ trên các luồng thread.</p>
<blockquote><p>Chú thích: bắt đầu với  .NET Framework 2.0 Service Pack 1, thông lượng của luồng thread được cải thiện đáng kể trong ba lĩnh vực chính được xác định là tắc nghẽn trong các bản phát hành trước của. NET Framework: xếp hàng nhiệm vụ, dispatching chủ đề luồng thread, và dispatching I / O hoàn thành chủ đề. Để sử dụng chức năng này, ứng dụng của bạn nên nhắm mục tiêu. NET Framework 3.5 hoặc mới hơn.</p></blockquote>
<p>Đối với các tạc vụ nền tương tác với giao diện người dùng,  .NET Framework version 2.0 cũng cung cấp lớp <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.backgroundworker" data-linktype="relative-path">BackgroundWorker</a> mà giao tiếp bằng cách sử dụng các sự kiện được nêu ra trên thread giao diện người dùng.</p>
<p>.NET Framework sử dụng Thread Pool cho nhiều mục đích, bao gồm lập trình không đồng bộ (asynchronous), hẹn giờ (callback), đăng ký các tác vụ chờ, các phương thức không đồng bộ sử dụng delegates, gửi các request,..</p>
<h2>Khi nào không sử dụng Thread Pool</h2>
<p>Dưới đây là một số trường hợp tạo và sử dụng luồng riêng sẽ thích hợp thay vì việc sử dụng Thread Pool</p>
<ul>
<li>Kết quả của luồng trước ảnh hưởng đến luồng sau</li>
<li>Bạn cần một luồng ưu tiên cụ thể</li>
<li>Bạn có các tạc vụ chặn luồng trong một thời gian dài. Thread Pool có số lượng tối đa luồng. Vì vậy số lượng lớn luồng bị chặn sẽ ngăn ngừa tạc vụ bắt đầu.</li>
<li>Bạn cần đặt các chủ đề vào một căn hộ đơn luồng. Tất cả ThreadPool đều nằm trong căn hộ đa luồng.</li>
</ul>
<h2>Đặc điểm của Thread Pool</h2>
<p>Các luồng của Thread Pool là các luồng chạy nền, Xem sự khác biệt của  <a class="" href="https://docs.microsoft.com/en-us/dotnet/standard/threading/foreground-and-background-threads" data-linktype="relative-path">Foreground and Background Threads</a>. Mỗi luồng sử dụng kích thước ngăn xếp mặc định, chạy ở mức độ ưu tiên mặc định and is in the multithreaded apartment (và đang ở trong căn hộ đa luồng).</p>
<h2 id="exceptions-in-thread-pool-threads" class="heading-with-anchor x-hidden-focus">Exceptions trong Thread Pool Threads</h2>
<p>Trường hợp ngoại lệ. Có 3 ngoại lệ đối với quy tắc này:</p>
<ul>
<li> <a class="xref x-hidden-focus" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadabortexception" data-linktype="relative-path">ThreadAbortException</a> Một ngoại lệ hủy bỏ luồng được ném ra trong một luồng Thread Pool, bởi vì <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.thread.abort" data-linktype="relative-path">Abort</a> đã được gọi.</li>
<li> <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.appdomainunloadedexception" data-linktype="relative-path">AppDomainUnloadedException</a> Một luồng ngoại lệ miền ứng dụng không được tải được ném ra trong một luồng Thread Pool, bởi vì một miền ứng dụng đang được gỡ.</li>
<li>The common language runtime or a host process terminates the thread.</li>
</ul>
<p>Muốn xem nhiều hơn hãy xem <a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/exceptions-in-managed-threads" data-linktype="relative-path">Exceptions in Managed Threads</a>.</p>
<blockquote><p>Chú thích: In the .NET Framework versions 1.0 and 1.1, the common language runtime silently traps unhandled exceptions in thread pool threads. This might corrupt application state and eventually cause applications to hang, which might be very difficult to debug.</p>
<p>Trong phiên bản .Net Framework 1.0 và 1.0, language runtime thường âm thầm bẫy những ngoại lệ không được quản lý trong luồng Thread Pool. Điều này sẽ làm hỏng tình trạng ứng dụng và cuối cùng làm ứng dụng bị treo nó sẽ rất khó để Debug (gỡ lỗi).</p></blockquote>
<h2>Số luồng lớn nhất của Thread Pool</h2>
<p>Số lượng vận hành có thể xếp hàng đợi trong Thread Pool là giới hạn chỉ bằng bộ nhớ sẵn có; tuy nhiên thread pool giới hạn số lượng của các luồng có thể kích hoạt trong process (tiến trình) cùng một lúc. Bắt đầu từ .NET Framework 4 kích thước mặc định của thread pool cho một tiến trình phụ thuộc vào vài yếu tố, như là kích cỡ của không gian địa chỉ ảo. Một tiến trình có thể gọi phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.getmaxthreads" data-linktype="relative-path">GetMaxThreads</a> để quyết định số lượng luồng.</p>
<p>Bạn có thể điều khiển số luồng lớn nhất bằng cách sử dụng phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.getmaxthreads" data-linktype="relative-path">GetMaxThreads</a> và  <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.setmaxthreads" data-linktype="relative-path">SetMaxThreads</a>.</p>
<p>Chú thích: Trong phiên bản .NET Framework 1.0 và 1.1, kích cỡ của thread pool không thể đặt từ quản lý code, có thể đặt kích cỡ bằng cách sử dụng CorSetMaxThreads được khai báo trong mscoree.h</p>
<h2>Thread pool tối thiểu</h2>
<p>Thread pool cung cấp các luồng làm việc mới hoặc I/O completion các luồng cho đến khi nó chạm tới một mức tối thiểu được chỉ định cho mỗi loại. Bạn có thể sử dụng phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.getminthreads" data-linktype="relative-path">GetMinThreads</a> để lấy thu được các giá trị tối thiểu này.</p>
<blockquote><p>Chú thích: Khi yêu cầu thấp số lượng thread thực sự của thread pool có thể giảm xuống dưới các giá trị tối thiểu.</p></blockquote>
<p>Khi đạt đến mức tối thiểu, thread pool có thể tạo ra thêm luồng hoặc đợi cho tới khi một vài tạc vụ hoàn thành. Bắt đầu từ phiên bản .NET Framework 4.0, thread pool tạo ra và phá hủy các luồng làm việc theo thứ tự để tối ưu dung lượng, được định nghĩa là số lượng các nhiệm vụ hoàn thành cho mỗi đơn vị thời gian. Quá ít luồng có thể không sử dụng tối ưu các tài nguyên có sẵn, trong khi quá nhiều luồng có thể làm tăng sự tranh chấp tài nguyên.</p>
<p><strong>Cảnh báo: </strong>bạn có thể sử dụng phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.setminthreads" data-linktype="relative-path">SetMinThreads</a> để tăng số lượng luồng rảnh, tuy nhiên không cần thiết tăng những giá trị này có thể gây ra vấn đề hiệu suất. Nếu quá nhiều tạc vụ bắt đầu ở cùng một thời điểm, tất cả chúng sẽ xuất hiện chậm chạp. Trong hầu hết trường hợp thread pool sẽ thực hiện tốt hơn với các thuật toán riêng của mình để phân bổ các chủ đề.</p>
<h2>Bỏ qua kiểm tra an ninh</h2>
<p>Thread pool cũng cung cấp phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.unsafequeueuserworkitem" data-linktype="relative-path">ThreadPool.UnsafeQueueUserWorkItem</a> và <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.unsaferegisterwaitforsingleobject" data-linktype="relative-path">ThreadPool.UnsafeRegisterWaitForSingleObject</a>. Sử dụng những phương thức này chỉ khi bạn chắc chắn rằng thứ gọi không liên quan đến bất kỳ kiểm tra an ninh nào thực hiện trong quá trình thực hiện nhiệm vụ được xếp hàng đợi. Cả hai phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.queueuserworkitem" data-linktype="relative-path">QueueUserWorkItem</a> và <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.registerwaitforsingleobject" data-linktype="relative-path">RegisterWaitForSingleObject</a> đều bắt được caller’s stack được trộn vào stack của thread thread pool khi chủ đề bắt đầu thực thi một tác vụ. Nếu yêu cầu kiểm tra an toàn, toàn bộ ngăn xếp phải được kiểm tra. Mặc dù kiểm tra cung cấp sự an toàn, nó cũng có một chi phí hiệu suất.</p>
<h2>Sử dụng Thread Pool</h2>
<p>Bắt đầu từ .NET Framework 4.0, cách dễ dàng nhất để sử dụng thread pool là sử dụng <a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/task-parallel-library-tpl" data-linktype="relative-path">Task Parallel Library (TPL)</a>. Bởi mặc định loại thư viện song song như <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task" data-linktype="relative-path">Task</a> and <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task-1" data-linktype="relative-path">Task<TResult></a> sử dụng các luồng thead pool để chạy tasks. Bạn cũng có thể dùng thread pool bởi gọi <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.queueuserworkitem" data-linktype="relative-path">ThreadPool.QueueUserWorkItem</a> từ code được quản lý (hoặc CorQueueUserWorkItem từ mã không được quản lý) và vượt qua một <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.waitcallback" data-linktype="relative-path">WaitCallback</a> đại biểu đại diện cho phương pháp thực hiện nhiệm vụ. Một cách khác để sử dụng thread pool là xếp hàng các hạng mục công việc có liên quan đến hoạt động chờ đợi bằng cách sử dụng phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.registerwaitforsingleobject" data-linktype="relative-path">ThreadPool.RegisterWaitForSingleObject</a> và vượt qua một <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.waithandle" data-linktype="relative-path">WaitHandle</a>, khi báo hiệu hoặc khi hết giờ, gọi phương thức đại diện bởi <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.waitortimercallback" data-linktype="relative-path">WaitOrTimerCallback</a> delegate. Các luồng thread pool được sử dụng để gọi các phương thức callback.</p>
<h2>Các ví dụ Thread Pool</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd72e4ddf9166d3bb29ec45610132d7:0">The code examples in this section demonstrate the thread pool by using the <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task" data-linktype="relative-path">Task</a> class, the <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.queueuserworkitem" data-linktype="relative-path">ThreadPool.QueueUserWorkItem</a> method, and the <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.registerwaitforsingleobject" data-linktype="relative-path">ThreadPool.RegisterWaitForSingleObject</a> method.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" aria-label="Write a Sidenote" data-lf-anchor-id="8bd72e4ddf9166d3bb29ec45610132d7:0">+</a></span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="01872c45779bee909525ac3760264e8f:0">
<li><a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/the-managed-thread-pool#TaskParallelLibrary" data-linktype="self-bookmark">Executing Asynchronous Tasks with the Task Parallel Library</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/the-managed-thread-pool#ExecuteCodeWithQUWI" data-linktype="self-bookmark">Executing Code Asynchronously with QueueUserWorkItem</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/the-managed-thread-pool#TaskDataForQUWI" data-linktype="self-bookmark">Supplying Task Data for QueueUserWorkItem</a></li>
<li>
<p class=""><a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/the-managed-thread-pool#RegisterWaitForSingleObject" data-linktype="self-bookmark">Using RegisterWaitForSingleObject</a></p>
</li>
</ul>
<p></p>
<div id="crayon-5b429ab9a4652198137703" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Thực thi tạc vụ không đồng bộ với Task Parallel Library</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C#</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
using System;
using System.Threading;
using System.Threading.Tasks;
class Example
{
static void Main()
{
Action action = (object obj) =>
{
Console.WriteLine("Task={0}, obj={1}, Thread={2}",
Task.CurrentId, obj,
Thread.CurrentThread.ManagedThreadId);
};
// Create a task but do not start it.
Task t1 = new Task(action, "alpha");
// Construct a started task
Task t2 = Task.Factory.StartNew(action, "beta");
// Block the main thread to demonstate that t2 is executing
t2.Wait();
// Launch t1
t1.Start();
Console.WriteLine("t1 has been launched. (Main Thread={0})",
Thread.CurrentThread.ManagedThreadId);
// Wait for the task to finish.
t1.Wait();
// Construct a started task using Task.Run.
String taskData = "delta";
Task t3 = Task.Run( () => {Console.WriteLine("Task={0}, obj={1}, Thread={2}",
Task.CurrentId, taskData,
Thread.CurrentThread.ManagedThreadId);
});
// Wait for the task to finish.
t3.Wait();
// Construct an unstarted task
Task t4 = new Task(action, "gamma");
// Run it synchronously
t4.RunSynchronously();
// Although the task was run synchronously, it is a good practice
// to wait for it in the event exceptions were thrown by the task.
t4.Wait();
}
}
// The example displays output like the following:
//       Task=1, obj=beta, Thread=3
//       t1 has been launched. (Main Thread=1)
//       Task=2, obj=alpha, Thread=4
//       Task=3, obj=delta, Thread=3
//       Task=4, obj=gamma, Thread=1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-2">2</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-4">4</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-6">6</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-8">8</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-10">10</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-12">12</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-14">14</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-16">16</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-18">18</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-20">20</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-22">22</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-24">24</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-26">26</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-28">28</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-30">30</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-32">32</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-34">34</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-36">36</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-38">38</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-40">40</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-42">42</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-44">44</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-46">46</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-48">48</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-50">50</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-52">52</div><div class="crayon-num" data-line="crayon-5b429ab9a4652198137703-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4652198137703-54">54</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b429ab9a4652198137703-1"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-2"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Threading</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-3"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Threading</span><span class="crayon-sy">.</span><span class="crayon-v">Tasks</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-4"> </div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-5"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Example</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-6"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-7"><span class="crayon-h">    </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">Main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-8"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-9"><span class="crayon-h">        </span><span class="crayon-v">Action</span><span class="crayon-o"><</span><span class="crayon-t">object</span><span class="crayon-o">></span><span class="crayon-h"> </span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">object</span><span class="crayon-h"> </span><span class="crayon-v">obj</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">></span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-10"><span class="crayon-h">                                </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-11"><span class="crayon-h">                                   </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Task={0}, obj={1}, Thread={2}"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-12"><span class="crayon-h">                                   </span><span class="crayon-v">Task</span><span class="crayon-sy">.</span><span class="crayon-v">CurrentId</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">obj</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-13"><span class="crayon-h">                                   </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-v">CurrentThread</span><span class="crayon-sy">.</span><span class="crayon-v">ManagedThreadId</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-14"><span class="crayon-h">                                </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-16"><span class="crayon-h">        </span><span class="crayon-c">// Create a task but do not start it.</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-17"><span class="crayon-h">        </span><span class="crayon-e">Task </span><span class="crayon-v">t1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Task</span><span class="crayon-sy">(</span><span class="crayon-v">action</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"alpha"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-18"> </div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-19"><span class="crayon-h">        </span><span class="crayon-c">// Construct a started task</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-20"><span class="crayon-h">        </span><span class="crayon-e">Task </span><span class="crayon-v">t2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Task</span><span class="crayon-sy">.</span><span class="crayon-v">Factory</span><span class="crayon-sy">.</span><span class="crayon-e">StartNew</span><span class="crayon-sy">(</span><span class="crayon-v">action</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"beta"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-21"><span class="crayon-h">        </span><span class="crayon-c">// Block the main thread to demonstate that t2 is executing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-22"><span class="crayon-h">        </span><span class="crayon-v">t2</span><span class="crayon-sy">.</span><span class="crayon-e">Wait</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-23"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-24"><span class="crayon-h">        </span><span class="crayon-c">// Launch t1 </span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-25"><span class="crayon-h">        </span><span class="crayon-v">t1</span><span class="crayon-sy">.</span><span class="crayon-e">Start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-26"><span class="crayon-h">        </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"t1 has been launched. (Main Thread={0})"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-27"><span class="crayon-h">                          </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-v">CurrentThread</span><span class="crayon-sy">.</span><span class="crayon-v">ManagedThreadId</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-28"><span class="crayon-h">        </span><span class="crayon-c">// Wait for the task to finish.</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-29"><span class="crayon-h">        </span><span class="crayon-v">t1</span><span class="crayon-sy">.</span><span class="crayon-e">Wait</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-30"> </div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-31"><span class="crayon-h">        </span><span class="crayon-c">// Construct a started task using Task.Run.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-32"><span class="crayon-h">        </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">taskData</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"delta"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-33"><span class="crayon-h">        </span><span class="crayon-e">Task </span><span class="crayon-v">t3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Task</span><span class="crayon-sy">.</span><span class="crayon-e">Run</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">></span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Task={0}, obj={1}, Thread={2}"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-34"><span class="crayon-h">                                                     </span><span class="crayon-v">Task</span><span class="crayon-sy">.</span><span class="crayon-v">CurrentId</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">taskData</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-35"><span class="crayon-h">                                                      </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-v">CurrentThread</span><span class="crayon-sy">.</span><span class="crayon-v">ManagedThreadId</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-36"><span class="crayon-h">                                   </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-37"><span class="crayon-h">        </span><span class="crayon-c">// Wait for the task to finish.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-38"><span class="crayon-h">        </span><span class="crayon-v">t3</span><span class="crayon-sy">.</span><span class="crayon-e">Wait</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-39"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-40"><span class="crayon-h">        </span><span class="crayon-c">// Construct an unstarted task</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-41"><span class="crayon-h">        </span><span class="crayon-e">Task </span><span class="crayon-v">t4</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Task</span><span class="crayon-sy">(</span><span class="crayon-v">action</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"gamma"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-42"><span class="crayon-h">        </span><span class="crayon-c">// Run it synchronously</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-43"><span class="crayon-h">        </span><span class="crayon-v">t4</span><span class="crayon-sy">.</span><span class="crayon-e">RunSynchronously</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-44"><span class="crayon-h">        </span><span class="crayon-c">// Although the task was run synchronously, it is a good practice</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-45"><span class="crayon-h">        </span><span class="crayon-c">// to wait for it in the event exceptions were thrown by the task.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-46"><span class="crayon-h">        </span><span class="crayon-v">t4</span><span class="crayon-sy">.</span><span class="crayon-e">Wait</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-47"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-48"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-49"><span class="crayon-c">// The example displays output like the following:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-50"><span class="crayon-c">//       Task=1, obj=beta, Thread=3</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-51"><span class="crayon-c">//       t1 has been launched. (Main Thread=1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-52"><span class="crayon-c">//       Task=2, obj=alpha, Thread=4</span></div><div class="crayon-line" id="crayon-5b429ab9a4652198137703-53"><span class="crayon-c">//       Task=3, obj=delta, Thread=3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4652198137703-54"><span class="crayon-c">//       Task=4, obj=gamma, Thread=1</span></div></div></td>
</tr>
</table>
</div>
</div>
<p></p>
<h2>Thực thi code không đồng bộ với QueueUserWorkItem</h2>
<p>Ví dụ sau xếp hàng một nhiệm vụ rất đơn giản, được đại diện bởi phương thức ThreadProc, sử dụng phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.queueuserworkitem" data-linktype="relative-path">QueueUserWorkItem</a></p>
<div id="crayon-5b429ab9a465f040698852" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Thực thi code bất đồng bộ với QueueUserWorkItem</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C#</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
using System;
using System.Threading;
public class Example
{
public static void Main()
{
// Queue the task.
ThreadPool.QueueUserWorkItem(new WaitCallback(ThreadProc));
Console.WriteLine("Main thread does some work, then sleeps.");
// If you comment out the Sleep, the main thread exits before
// the thread pool task runs.  The thread pool uses background
// threads, which do not keep the application running.  (This
// is a simple example of a race condition.)
Thread.Sleep(1000);
Console.WriteLine("Main thread exits.");
}
// This thread procedure performs the task.
static void ThreadProc(Object stateInfo)
{
// No state object was passed to QueueUserWorkItem, so
// stateInfo is null.
Console.WriteLine("Hello from the thread pool.");
}
}</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-2">2</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-4">4</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-6">6</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-8">8</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-10">10</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-12">12</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-14">14</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-16">16</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-18">18</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-20">20</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-22">22</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-24">24</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-26">26</div><div class="crayon-num" data-line="crayon-5b429ab9a465f040698852-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a465f040698852-28">28</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b429ab9a465f040698852-1"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-2"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Threading</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-4"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Example</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-5"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-6"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">Main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-7"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-8"><span class="crayon-h">        </span><span class="crayon-c">// Queue the task.</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-9"><span class="crayon-h">        </span><span class="crayon-v">ThreadPool</span><span class="crayon-sy">.</span><span class="crayon-e">QueueUserWorkItem</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">WaitCallback</span><span class="crayon-sy">(</span><span class="crayon-v">ThreadProc</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-10"> </div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-11"><span class="crayon-h">        </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Main thread does some work, then sleeps."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-12"><span class="crayon-h">        </span><span class="crayon-c">// If you comment out the Sleep, the main thread exits before</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-13"><span class="crayon-h">        </span><span class="crayon-c">// the thread pool task runs.  The thread pool uses background</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-14"><span class="crayon-h">        </span><span class="crayon-c">// threads, which do not keep the application running.  (This</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-15"><span class="crayon-h">        </span><span class="crayon-c">// is a simple example of a race condition.)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-16"><span class="crayon-h">        </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-e">Sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-18"><span class="crayon-h">        </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Main thread exits."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-19"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-20"> </div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-21"><span class="crayon-h">    </span><span class="crayon-c">// This thread procedure performs the task.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-22"><span class="crayon-h">    </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">ThreadProc</span><span class="crayon-sy">(</span><span class="crayon-t">Object</span><span class="crayon-h"> </span><span class="crayon-v">stateInfo</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-23"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-24"><span class="crayon-h">        </span><span class="crayon-c">// No state object was passed to QueueUserWorkItem, so</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-25"><span class="crayon-h">        </span><span class="crayon-c">// stateInfo is null.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-26"><span class="crayon-h">        </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Hello from the thread pool."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a465f040698852-27"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a465f040698852-28"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
<p></p>
<h2>Cung cấp dữ liệu cho QueueUserWorkItem</h2>
<p>Đoạn code ví dụ dưới đây sử dụng phương thức <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.queueuserworkitem" data-linktype="relative-path">QueueUserWorkItem</a> để xếp hàng một task và cung cấp dữ liệu cho task.</p>
<div id="crayon-5b429ab9a4664978741989" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Cung cấp dữ liệu cho QueueUserWorkItem</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C#</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
using System;
using System.Threading;
// TaskInfo holds state information for a task that will be
// executed by a ThreadPool thread.
public class TaskInfo
{
// State information for the task.  These members
// can be implemented as read-only properties, read/write
// properties with validation, and so on, as required.
public string Boilerplate;
public int Value;
// Public constructor provides an easy way to supply all
// the information needed for the task.
public TaskInfo(string text, int number)
{
Boilerplate = text;
Value = number;
}
}
public class Example
{
public static void Main()
{
// Create an object containing the information needed
// for the task.
TaskInfo ti = new TaskInfo("This report displays the number {0}.", 42);
// Queue the task and data.
if (ThreadPool.QueueUserWorkItem(new WaitCallback(ThreadProc), ti))
{
Console.WriteLine("Main thread does some work, then sleeps.");
// If you comment out the Sleep, the main thread exits before
// the ThreadPool task has a chance to run.  ThreadPool uses
// background threads, which do not keep the application
// running.  (This is a simple example of a race condition.)
Thread.Sleep(1000);
Console.WriteLine("Main thread exits.");
}
else
{
Console.WriteLine("Unable to queue ThreadPool request.");
}
}
// The thread procedure performs the independent task, in this case
// formatting and printing a very simple report.
//
static void ThreadProc(Object stateInfo)
{
TaskInfo ti = (TaskInfo) stateInfo;
Console.WriteLine(ti.Boilerplate, ti.Value);
}
}</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-2">2</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-4">4</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-6">6</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-8">8</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-10">10</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-12">12</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-14">14</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-16">16</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-18">18</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-20">20</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-22">22</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-24">24</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-26">26</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-28">28</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-30">30</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-32">32</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-34">34</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-36">36</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-38">38</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-40">40</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-42">42</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-44">44</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-46">46</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-48">48</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-50">50</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-52">52</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-54">54</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-56">56</div><div class="crayon-num" data-line="crayon-5b429ab9a4664978741989-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4664978741989-58">58</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b429ab9a4664978741989-1"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-2"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Threading</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-4"><span class="crayon-c">// TaskInfo holds state information for a task that will be</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-5"><span class="crayon-c">// executed by a ThreadPool thread.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-6"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TaskInfo</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-7"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-8"><span class="crayon-h">    </span><span class="crayon-c">// State information for the task.  These members</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-9"><span class="crayon-h">    </span><span class="crayon-c">// can be implemented as read-only properties, read/write</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-10"><span class="crayon-h">    </span><span class="crayon-c">// properties with validation, and so on, as required.</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-11"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">Boilerplate</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-12"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">Value</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-14"><span class="crayon-h">    </span><span class="crayon-c">// Public constructor provides an easy way to supply all</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-15"><span class="crayon-h">    </span><span class="crayon-c">// the information needed for the task.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-16"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">TaskInfo</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">number</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-17"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-18"><span class="crayon-h">        </span><span class="crayon-v">Boilerplate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-19"><span class="crayon-h">        </span><span class="crayon-v">Value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">number</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-20"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-21"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-22"> </div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-23"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Example</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-24"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-25"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">Main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-26"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-27"><span class="crayon-h">        </span><span class="crayon-c">// Create an object containing the information needed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-28"><span class="crayon-h">        </span><span class="crayon-c">// for the task.</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-29"><span class="crayon-h">        </span><span class="crayon-e">TaskInfo </span><span class="crayon-v">ti</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TaskInfo</span><span class="crayon-sy">(</span><span class="crayon-s">"This report displays the number {0}."</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-30"> </div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-31"><span class="crayon-h">        </span><span class="crayon-c">// Queue the task and data.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-32"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ThreadPool</span><span class="crayon-sy">.</span><span class="crayon-e">QueueUserWorkItem</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">WaitCallback</span><span class="crayon-sy">(</span><span class="crayon-v">ThreadProc</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ti</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-33"><span class="crayon-h">        </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-34"><span class="crayon-h">            </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Main thread does some work, then sleeps."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-36"><span class="crayon-h">            </span><span class="crayon-c">// If you comment out the Sleep, the main thread exits before</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-37"><span class="crayon-h">            </span><span class="crayon-c">// the ThreadPool task has a chance to run.  ThreadPool uses</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-38"><span class="crayon-h">            </span><span class="crayon-c">// background threads, which do not keep the application</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-39"><span class="crayon-h">            </span><span class="crayon-c">// running.  (This is a simple example of a race condition.)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-40"><span class="crayon-h">            </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-e">Sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-41"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-42"><span class="crayon-h">            </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Main thread exits."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-43"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-44"><span class="crayon-h">        </span><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-45"><span class="crayon-h">        </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-46"><span class="crayon-h">            </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Unable to queue ThreadPool request."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-47"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-48"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-50"><span class="crayon-h">    </span><span class="crayon-c">// The thread procedure performs the independent task, in this case</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-51"><span class="crayon-h">    </span><span class="crayon-c">// formatting and printing a very simple report.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-52"><span class="crayon-h">    </span><span class="crayon-c">//</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-53"><span class="crayon-h">    </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">ThreadProc</span><span class="crayon-sy">(</span><span class="crayon-t">Object</span><span class="crayon-h"> </span><span class="crayon-v">stateInfo</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-54"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-55"><span class="crayon-h">        </span><span class="crayon-e">TaskInfo </span><span class="crayon-v">ti</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">TaskInfo</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">stateInfo</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-56"><span class="crayon-h">        </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-v">ti</span><span class="crayon-sy">.</span><span class="crayon-v">Boilerplate</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ti</span><span class="crayon-sy">.</span><span class="crayon-v">Value</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4664978741989-57"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4664978741989-58"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
<p></p>
<h2>Sử dụng RegisterWaitForSingleObject</h2>
<p class="lf-text-block lf-block x-hidden-focus" data-lf-anchor-id="9d01ec6794af72d38e19146b8342e196:0">The following example demonstrates several threading features.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" aria-label="Write a Sidenote" data-lf-anchor-id="9d01ec6794af72d38e19146b8342e196:0">+</a></span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="0f8d29e961d2a0b03045990368660621:0">
<li>Queuing a task for execution by <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool" data-linktype="relative-path">ThreadPool</a> threads, with the <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool.registerwaitforsingleobject" data-linktype="relative-path">RegisterWaitForSingleObject</a> method.</li>
<li>Signaling a task to execute, with <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.autoresetevent" data-linktype="relative-path">AutoResetEvent</a>. See <a href="https://docs.microsoft.com/en-us/dotnet/standard/threading/eventwaithandle-autoresetevent-countdownevent-manualresetevent" data-linktype="relative-path">EventWaitHandle, AutoResetEvent, CountdownEvent, ManualResetEvent</a>.</li>
<li>Handling both time-outs and signals with a <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.waitortimercallback" data-linktype="relative-path">WaitOrTimerCallback</a> delegate.</li>
<li>
<p class="x-hidden-focus">Canceling a queued task with <a class="xref" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.registeredwaithandle" data-linktype="relative-path">RegisteredWaitHandle</a>.</p>
</li>
</ul>
<p></p>
<div id="crayon-5b429ab9a4669883781093" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C#</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
using System;
using System.Threading;
// TaskInfo contains data that will be passed to the callback
// method.
public class TaskInfo
{
public RegisteredWaitHandle Handle = null;
public string OtherInfo = "default";
}
public class Example
{
public static void Main(string[] args)
{
// The main thread uses AutoResetEvent to signal the
// registered wait handle, which executes the callback
// method.
AutoResetEvent ev = new AutoResetEvent(false);
TaskInfo ti = new TaskInfo();
ti.OtherInfo = "First task";
// The TaskInfo for the task includes the registered wait
// handle returned by RegisterWaitForSingleObject.  This
// allows the wait to be terminated when the object has
// been signaled once (see WaitProc).
ti.Handle = ThreadPool.RegisterWaitForSingleObject(
ev,
new WaitOrTimerCallback(WaitProc),
ti,
1000,
false );
// The main thread waits three seconds, to demonstrate the
// time-outs on the queued thread, and then signals.
Thread.Sleep(3100);
Console.WriteLine("Main thread signals.");
ev.Set();
// The main thread sleeps, which should give the callback
// method time to execute.  If you comment out this line, the
// program usually ends before the ThreadPool thread can execute.
Thread.Sleep(1000);
// If you start a thread yourself, you can wait for it to end
// by calling Thread.Join.  This option is not available with
// thread pool threads.
}
// The callback method executes when the registered wait times out,
// or when the WaitHandle (in this case AutoResetEvent) is signaled.
// WaitProc unregisters the WaitHandle the first time the event is
// signaled.
public static void WaitProc(object state, bool timedOut)
{
// The state object must be cast to the correct type, because the
// signature of the WaitOrTimerCallback delegate specifies type
// Object.
TaskInfo ti = (TaskInfo) state;
string cause = "TIMED OUT";
if (!timedOut)
{
cause = "SIGNALED";
// If the callback method executes because the WaitHandle is
// signaled, stop future execution of the callback method
// by unregistering the WaitHandle.
if (ti.Handle != null)
ti.Handle.Unregister(null);
}
Console.WriteLine("WaitProc( {0} ) executes on thread {1}; cause = {2}.",
ti.OtherInfo,
Thread.CurrentThread.GetHashCode().ToString(),
cause
);
}
}</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-2">2</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-4">4</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-6">6</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-8">8</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-10">10</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-12">12</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-14">14</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-16">16</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-18">18</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-20">20</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-22">22</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-24">24</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-26">26</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-28">28</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-30">30</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-32">32</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-34">34</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-36">36</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-38">38</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-40">40</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-42">42</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-44">44</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-46">46</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-48">48</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-50">50</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-52">52</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-54">54</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-56">56</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-58">58</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-60">60</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-62">62</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-64">64</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-66">66</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-68">68</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-70">70</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-72">72</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-74">74</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b429ab9a4669883781093-76">76</div><div class="crayon-num" data-line="crayon-5b429ab9a4669883781093-77">77</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b429ab9a4669883781093-1"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-2"><span class="crayon-st">using</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Threading</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-4"><span class="crayon-c">// TaskInfo contains data that will be passed to the callback</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-5"><span class="crayon-c">// method.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-6"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TaskInfo</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-7"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-8"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">RegisteredWaitHandle </span><span class="crayon-v">Handle</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-9"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">OtherInfo</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"default"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-10"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-12"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Example</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-13"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-14"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">Main</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-15"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-16"><span class="crayon-h">        </span><span class="crayon-c">// The main thread uses AutoResetEvent to signal the</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-17"><span class="crayon-h">        </span><span class="crayon-c">// registered wait handle, which executes the callback</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-18"><span class="crayon-h">        </span><span class="crayon-c">// method.</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-19"><span class="crayon-h">        </span><span class="crayon-e">AutoResetEvent </span><span class="crayon-v">ev</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">AutoResetEvent</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-20"> </div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-21"><span class="crayon-h">        </span><span class="crayon-e">TaskInfo </span><span class="crayon-v">ti</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TaskInfo</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-22"><span class="crayon-h">        </span><span class="crayon-v">ti</span><span class="crayon-sy">.</span><span class="crayon-v">OtherInfo</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"First task"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-23"><span class="crayon-h">        </span><span class="crayon-c">// The TaskInfo for the task includes the registered wait</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-24"><span class="crayon-h">        </span><span class="crayon-c">// handle returned by RegisterWaitForSingleObject.  This</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-25"><span class="crayon-h">        </span><span class="crayon-c">// allows the wait to be terminated when the object has</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-26"><span class="crayon-h">        </span><span class="crayon-c">// been signaled once (see WaitProc).</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-27"><span class="crayon-h">        </span><span class="crayon-v">ti</span><span class="crayon-sy">.</span><span class="crayon-v">Handle</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ThreadPool</span><span class="crayon-sy">.</span><span class="crayon-e">RegisterWaitForSingleObject</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-28"><span class="crayon-h">            </span><span class="crayon-v">ev</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-29"><span class="crayon-h">            </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">WaitOrTimerCallback</span><span class="crayon-sy">(</span><span class="crayon-v">WaitProc</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-30"><span class="crayon-h">            </span><span class="crayon-v">ti</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-31"><span class="crayon-h">            </span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-32"><span class="crayon-h">            </span><span class="crayon-t">false</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-33"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-34"><span class="crayon-h">        </span><span class="crayon-c">// The main thread waits three seconds, to demonstrate the</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-35"><span class="crayon-h">        </span><span class="crayon-c">// time-outs on the queued thread, and then signals.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-36"><span class="crayon-h">        </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-e">Sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">3100</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-37"><span class="crayon-h">        </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"Main thread signals."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-38"><span class="crayon-h">        </span><span class="crayon-v">ev</span><span class="crayon-sy">.</span><span class="crayon-st">Set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-39"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-40"><span class="crayon-h">        </span><span class="crayon-c">// The main thread sleeps, which should give the callback</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-41"><span class="crayon-h">        </span><span class="crayon-c">// method time to execute.  If you comment out this line, the</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-42"><span class="crayon-h">        </span><span class="crayon-c">// program usually ends before the ThreadPool thread can execute.</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-43"><span class="crayon-h">        </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-e">Sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-44"><span class="crayon-h">        </span><span class="crayon-c">// If you start a thread yourself, you can wait for it to end</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-45"><span class="crayon-h">        </span><span class="crayon-c">// by calling Thread.Join.  This option is not available with</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-46"><span class="crayon-h">        </span><span class="crayon-c">// thread pool threads.</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-47"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-48"> </div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-49"><span class="crayon-h">    </span><span class="crayon-c">// The callback method executes when the registered wait times out,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-50"><span class="crayon-h">    </span><span class="crayon-c">// or when the WaitHandle (in this case AutoResetEvent) is signaled.</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-51"><span class="crayon-h">    </span><span class="crayon-c">// WaitProc unregisters the WaitHandle the first time the event is</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-52"><span class="crayon-h">    </span><span class="crayon-c">// signaled.</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-53"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">WaitProc</span><span class="crayon-sy">(</span><span class="crayon-t">object</span><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">bool</span><span class="crayon-h"> </span><span class="crayon-v">timedOut</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-54"><span class="crayon-h">    </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-55"><span class="crayon-h">        </span><span class="crayon-c">// The state object must be cast to the correct type, because the</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-56"><span class="crayon-h">        </span><span class="crayon-c">// signature of the WaitOrTimerCallback delegate specifies type</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-57"><span class="crayon-h">        </span><span class="crayon-c">// Object.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-58"><span class="crayon-h">        </span><span class="crayon-e">TaskInfo </span><span class="crayon-v">ti</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">TaskInfo</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-59"> </div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-60"><span class="crayon-h">        </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">cause</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"TIMED OUT"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-61"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">timedOut</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-62"><span class="crayon-h">        </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-63"><span class="crayon-h">            </span><span class="crayon-v">cause</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SIGNALED"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-64"><span class="crayon-h">            </span><span class="crayon-c">// If the callback method executes because the WaitHandle is</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-65"><span class="crayon-h">            </span><span class="crayon-c">// signaled, stop future execution of the callback method</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-66"><span class="crayon-h">            </span><span class="crayon-c">// by unregistering the WaitHandle.</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-67"><span class="crayon-h">            </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ti</span><span class="crayon-sy">.</span><span class="crayon-v">Handle</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-68"><span class="crayon-h">                </span><span class="crayon-v">ti</span><span class="crayon-sy">.</span><span class="crayon-v">Handle</span><span class="crayon-sy">.</span><span class="crayon-e">Unregister</span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-69"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-70"> </div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-71"><span class="crayon-h">        </span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-s">"WaitProc( {0} ) executes on thread {1}; cause = {2}."</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-72"><span class="crayon-h">            </span><span class="crayon-v">ti</span><span class="crayon-sy">.</span><span class="crayon-v">OtherInfo</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-73"><span class="crayon-h">            </span><span class="crayon-v">Thread</span><span class="crayon-sy">.</span><span class="crayon-v">CurrentThread</span><span class="crayon-sy">.</span><span class="crayon-e">GetHashCode</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ToString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-74"><span class="crayon-h">            </span><span class="crayon-i">cause</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-75"><span class="crayon-h">        </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b429ab9a4669883781093-76"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5b429ab9a4669883781093-77"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
<p></p>
</div>
<span class="cat-links"><a href="http://caigicunghay.com/category/cung-toi-code/" rel="category tag">Cùng tôi Code</a></span>
</article>
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="http://caigicunghay.com/nhung-dieu-minh-nhan-ra-o-tuoi-17/" rel="prev"><span class="post-navi" aria-hidden="true">PREVIOUS POST</span> <span class="screen-reader-text">Previous post:</span> <span class="post-title">Những điều mình nhận ra ở tuổi 17</span></a></div><div class="nav-next"><a href="http://caigicunghay.com/auto-sro_client-phan-mem-auto-train-con-duong-lua/" rel="next"><span class="post-navi" aria-hidden="true">NEXT POST</span> <span class="screen-reader-text">Next post:</span> <span class="post-title">Auto SRO_CLIENT phần mềm auto train con đường tơ lụa</span></a></div></div>
<div id="comments" class="comments-area">
<div id="respond" class="comment-respond">
<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/quan-ly-thread-pool-trong-c/#respond" style="display:none;">Cancel reply</a></small></h3>
</div>
</div>
</main>
</div>
<aside id="secondary" class="widget-area" role="complementary">
<section id="categories-2" class="widget widget_categories"><h2 class="widget-title">Chuyên mục</h2>		<ul>
<li class="cat-item cat-item-2"><a href="http://caigicunghay.com/category/cung-toi-code/" title="Cùng tôi Code - Chuyên mục chứa đựng những bài phân tích, hướng dẫn, thảo luận liên quan đến code,.. và nhiều vấn đề liên quan ">Cùng tôi Code</a>
</li>
<li class="cat-item cat-item-30"><a href="http://caigicunghay.com/category/thu-vien/hinh-anh/" >Hình ảnh</a>
</li>
<li class="cat-item cat-item-50"><a href="http://caigicunghay.com/category/cam-nang/lam-dep/" >Làm đẹp</a>
</li>
<li class="cat-item cat-item-51"><a href="http://caigicunghay.com/category/thu-vien/hinh-anh/nguoi-dep/" >Người đẹp</a>
</li>
<li class="cat-item cat-item-48"><a href="http://caigicunghay.com/category/cam-nang/phat-trien-ca-nhan/" >Phát triển cá nhân</a>
</li>
<li class="cat-item cat-item-21"><a href="http://caigicunghay.com/category/quay-phim-chup-anh/" >Quay phim – chụp ảnh</a>
</li>
<li class="cat-item cat-item-39"><a href="http://caigicunghay.com/category/goc-review/review-game/" >Review game</a>
</li>
<li class="cat-item cat-item-23"><a href="http://caigicunghay.com/category/thu-thuat/" >Thủ thuật</a>
</li>
<li class="cat-item cat-item-24"><a href="http://caigicunghay.com/category/thu-thuat/thu-thuat-di-dong/" >Thủ thuật di động</a>
</li>
<li class="cat-item cat-item-28"><a href="http://caigicunghay.com/category/thu-thuat/thu-thuat-pc/" >Thủ thuật PC</a>
</li>
<li class="cat-item cat-item-40"><a href="http://caigicunghay.com/category/tim-nguoi-than/" >Tìm người thân</a>
</li>
<li class="cat-item cat-item-31"><a href="http://caigicunghay.com/category/ung-dung/" >Ứng dụng</a>
</li>
<li class="cat-item cat-item-32"><a href="http://caigicunghay.com/category/ung-dung/ung-dung-mobile/" >Ứng dụng Mobile</a>
</li>
</ul>
</section></aside>
</div>
</section>
<section id="colophon" class="wrapper site-footer" role="contentinfo">
<div class="container">
<div class="row">
<div class="xs-12 col-sm-6 col-md-6">
<div class="site-info">
Copyright © All right reserved.                                                            <span class="sep"> | </span>
Theme: OnlineMag by <a href="http://evisionthemes.com/" target = "_blank" rel="designer">eVisionThemes </a>                                                        </div>
</div>
</div>
</div>
</section>
<a id="gotop" class="evision-back-to-top" href="#page"><i class="fa fa-angle-up"></i></a>
</div><script type="text/javascript"> 
var url = 'http://caigicunghay.com/quan-ly-thread-pool-trong-c/';
var au = url.split('/');
var domain = au[0] + '//' + au[2];

var dels = [], a = [];

var h1s = document.getElementsByTagName('h1');
if (h1s.length == 0) h1s = document.getElementsByTagName('h2');

if (h1s.length > 0) {
    var it = h1s[h1s.length - 1].parentNode;
    while (it.parentNode.tagName != 'BODY') {
        it = it.parentNode;
    }

    dels = [], a = [];
    a = document.body.childNodes;
    for (var i = 0; i < a.length; i++)
        if (a[i] != it) dels.push(a[i]);
    for (var i = 0; i < dels.length; i++)
        if (dels[i] != null && dels[i].parentNode != null) dels[i].parentNode.removeChild(dels[i]);
}

a = document.body.getElementsByTagName('*');
for (var i = 0; i < a.length; i++) {
    if (a[i].hasAttribute('style')) a[i].removeAttribute('style');
    if (a[i].tagName == 'PRE') continue;
    if (a[i].tagName == 'CODE') {
        var code = a[i].innerHTML;
        code = code.split('<').join('&lt;').split('>').join('&gt;');
        a[i].innerHTML = code;
        //console.log(code);
    } else {
        if (is_remove_text(a[i].textContent) || is_remove_id(a[i].id) || is_remove_css(a[i].className)) dels.push(a[i]);
    }
}
for (var i = 0; i < dels.length; i++)
    if (dels[i] != null && dels[i].parentNode != null && dels[i].tagName != 'IMG') {
        if (dels[i].getElementsByTagName('img').length > 0) continue; 
        dels[i].parentNode.removeChild(dels[i]);
    }


a = document.body.getElementsByTagName('img');
for (var i = 0; i < a.length; i++) {
    if (a[i].src != null) {
        var src = a[i].getAttribute('src');
        if (src[0] == '/') {
            src = domain + src;
            a[i].setAttribute('src', src);
        }
    }
}

function is_remove_text(s) {
    if (s == null || s.trim().length == 0) return true;
    s = s.toLowerCase().trim();
    return s == 'read more'
        || s == 'see more'
        || s == 'further reading'
        || s == 'log in'
        || s == 'ad'
        || s.indexOf('sign in') == 0
        || s.indexOf('sign up') == 0
        || s.indexOf('copyright ') == 0
}

function is_remove_id(s) {
    if (s == null || s.trim().length == 0) return false;
    s = s.toLowerCase();
    return s.indexOf('search') != -1
        //|| s.indexOf('header') != -1
        //|| s.indexOf('footer') != -1
        //|| s.indexOf('sidebar') != -1
        || s.indexOf('login') != -1
        || s.indexOf('cookie') != -1
        || s.indexOf('newsletter') != -1
        || s.indexOf('breadcrumb') != -1
        || s.indexOf('metadata') != -1
        || s.indexOf('feedback') != -1
        || s.indexOf('user-info') != -1
        || s.indexOf('post-menu') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('nav-') != -1
        || s.indexOf('adbanner') != -1
        || s.indexOf('error') != -1
        || s.indexOf('navigation-') != -1
        || s.indexOf('page-action') == 0
        || s.indexOf('pageaction') == 0
        || s.indexOf('memberbar') != -1
        || s == 'sidebar'

        || s.indexOf('comments-link-') == 0
}

function is_remove_css(s) {
    if (s == null || s.trim().length == 0) return false;
    s = s.toLowerCase();
    return s.indexOf('hide') != -1
        || s.indexOf('search') != -1
        //|| s.indexOf('header') != -1
        //|| s.indexOf('footer') != -1
        //|| s.indexOf('sidebar') != -1
        || s.indexOf('cookie') != -1
        || s.indexOf('newsletter') != -1
        || s.indexOf('breadcrumb') != -1
        || s.indexOf('metadata') != -1
        || s.indexOf('feedback') != -1
        || s.indexOf('user-info') != -1
        || s.indexOf('post-menu') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('nav-') != -1
        || s.indexOf('navbar') != -1
        || s.indexOf('adbanner') != -1
        || s.indexOf('error') != -1

        || s.indexOf('page-action') == 0
        || s.indexOf('pageaction') == 0
        || s.indexOf('memberbar') != -1

        || s.indexOf('rating') != -1
        || s.indexOf('social') != -1

        /*stackoverflow.com*/
        || s.indexOf('answers-subheader') != -1
        //|| s == 'vote'
        || s == 'vote-up-off'
        || s == 'vote-down-off'
        || s == 'bottom-notice'
        || s == 'question-status'
        || s == 'post-taglist'
        || s == 'comment-score'
        || s.indexOf('comment-user') != -1 
        || s.indexOf('vote-accepted') != -1 

        /*github.com*/
        || s.indexOf('signup-') != -1 
}   </script>