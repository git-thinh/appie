<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title></title><style type="text/css">html * {
    padding: 0;
    margin: 0;
}

body {
    padding: 20px 10px;
    margin: 0;
    font-size: 1.5em;
}

h1 {
    text-align: left;
    clear: both;
    padding-bottom: 30px;
    padding-top: 10px;
    font-size: 1.9em;
    line-height: 1.1em;
}


h2, h3, h4, h5, h6 {
    margin: 0px;
    line-height: 1.1em;
}

h2, h3 {
    padding: 15px 0;
    font-size: 1.5em;
}

h4, h5, h6 {
    padding: 20px 0 0 0;
    font-size: 1.1em;
}

audio {
    padding: 10px;
    margin: 0px;
}

article {
    display: inline-block;
    width: 100%;
    padding-bottom: 30px;
}

pre {
    display: inline-block;
    width: auto;
    clear: both;
    margin: 3px 0 7px 0;
    background-color: #eff0f1; /*#fcc*/
    padding: 7px 30px;
    line-height: 1.5em;
    white-space: pre-wrap;
    font-size: 0.7em;
    font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif;
}

code {
    padding: 1px 5px;
    background-color: #eff0f1;
    font-size: 0.7em;
    font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif;
}

div {
    line-height: 1.3em;
}

ul, ol {
    clear: both;
    display: inline-block;
    margin: 0;
    padding: 0 0 15px 40px;
    min-width: 90%;
}

    ul li, ol li {
        display: list-item;
        width: 100%;
        clear: both;
        margin: 0;
        padding: 0 0 5px 0;
    }

        ul li ul, ol li ol {
            padding: 10px 40px;
        }

        ul li div, ul li p, ul li span, ul li i {
            font-style: normal;
            font-size: 1em;
        }

        ul li a {
            font-weight: bold;
        }

p {
    padding: 0;
    margin: 0;
    line-height: 1.7em;
}

a {
    text-decoration: none;
    font-weight: normal;
    color: #07C;
}

    a:visited {
        color: #005999;
    }

    a:hover {
        color: blue;
        text-decoration: underline;
    }


img {
    max-width: 90% !important;
}

/*stackoverflow.com*/

body.stackoverflow .question .comments-list {
    border-top: 3px solid #777;
    margin-top: 30px;
    padding-top: 30px;
}

body.stackoverflow .question .votecell {
    display: none;
}

body.stackoverflow #answers {
    border-top: 3px solid #000;
    margin-top: 30px;
    padding-top: 30px;
    padding-left: 70px;
}

    body.stackoverflow #answers .pager-answers {
        text-align: right;
        padding-bottom: 15px;
    }


    body.stackoverflow #answers .vote {
        text-align: right;
    }

        body.stackoverflow #answers .vote .vote-count-post {
            border: 1px solid #ddd;
            font-size: 0.7em;
            padding: 3px;
            color: #ccc;
        }

    body.stackoverflow #answers ul.comments-list {
        padding-left: 70px;
        padding-top: 20px;
    }

        body.stackoverflow #answers ul.comments-list li.comment .comment-body {
            font-size: 0.8em;
        }

        body.stackoverflow #answers ul.comments-list li.comment .comment-date {
            font-size: 0.7em;
            color: #ccc;
            font-style: normal;
        }

    body.stackoverflow #answers .answer,
    body.stackoverflow #answers .accepted-answer {
        border-bottom: 1px solid #555;
        margin-bottom: 10px;
        padding-bottom: 10px;
    }

/*github.com*/

body.github .file-navigation, body.github .pagehead-actions, body.github .gist-banner, body.github .js-permalink-shortcut, body.github .commit-tease, body.github .repository-lang-stats-graph, body.github .pagehead-actions {
    display: none;
}

body.github ul.numbers-summary li {
    float: left;
    margin-right: 30px;
    width: auto;
    clear: none;
    padding-top: 15px;
}

/*docs.microsoft.com*/

body.microsoft .content-header, body.microsoft #secondary #sidebar-widget-area {
    display: none;
}
body.microsoft a[data-linktype="relative-path"] {
    display: block;
    width: 100%;
}

/*codeproject.com*/

body.codeproject .site-top-menu, body.codeproject .sub-headerbar, body.codeproject .article-wing-left, body.codeproject .article-wing-right, body.codeproject .container-content .article-nav, body.codeproject .site-header, body.codeproject .content-list .content-list-item .thumbnail {
    display: none;
} 
</style></head><body class=codeproject><img alt="Click here to Skip to main content" src="https://codeproject.global.ssl.fastly.net/images/t.gif" /></a>
<div class="page-background">
<div id="ctl00_STM" class="site-top-menu fixed">
<div class="main-content">
<div class="container memberbar clearfix">
<div id="ctl00_MemberMenu_GenInfo" class="float-left">13,601,427 members</div>
<div class="float-left">
</div>
<div class="float-right">
<a name="SignUp"></a>
<span class="member-signin tooltip openable">
<span><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f7933%2fSmart-Thread-Pool">Sign in</a>
<img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/login32.png"
width="16px" height="16px" style="vertical-align:middle;"/>
</span>
<div class="tooltip-flyout">
<hr class="divider-dark" />
Sign in with <a class="oauth" title="Sign in using Github" href="/script/Membership/OAuthLogOn.aspx?auth=GitHub"><img src="/script/Membership/Images/octicons_github.png" style="vertical-align:middle;padding-right:3px;border:0;" /></a>
<a class="oauth" title="Sign in using Linkedin" href="/script/Membership/OAuthLogOn.aspx?auth=LinkedIn"><img src="/script/Membership/Images/linkedin.png" style="vertical-align:middle;padding-right:3px;border:0;" /></a>
<a class="oauth" title="Sign in using Facebook" href="/script/Membership/OAuthLogOn.aspx?auth=Facebook"><img src="/script/Membership/Images/facebook.png" style="vertical-align:middle;padding-right:3px;border:0;" /></a>
<a class="oauth" title="Sign in using Google" href="/script/Membership/OAuthLogOn.aspx?auth=Google"><img src="/script/Membership/Images/google-plus.png" style="vertical-align:middle;padding-right:3px;border:0;" /></a>
<a class="oauth" title="Sign in using Microsoft" href="/script/Membership/OAuthLogOn.aspx?auth=Microsoft"><img src="/script/Membership/Images/microsoft.png" style="vertical-align:middle;padding-right:3px;border:0;" /></a>
</div>
</span>
</div>
</div>
</div>
</div>
<div id="ctl00_SH" class="site-header fixed">
<div class="main-content">
<div class="logo"><a href="/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;" /></a></div>
<div class="promo"><div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Thread-Pooling"  data-tags='.NET2.0, WinXP, Win2003, VS2005, Mono, .NET3.0, .NET3.5, VS2008, C#, Windows, .NET, Visual-Studio, Dev, Intermediate, Win2008, Win7, VS2010, Win2008-R2, threads, .NET4,rating4.5'></div></div>
</div>
</div>
<a href="#Main"><img alt="Click here to Skip to main content" class="access-link"
src="https://codeproject.global.ssl.fastly.net/images/t.gif" /></a>
<div id="ctl00_TPR" class="sub-headerbar clearfix fixed">
<div class="float-right">
<div class="searchbar">
</div>
</div>
<div class="float-left">
<div class="navbar clearfix">
<ul class="navmenu openable">
<li class="desktop-only"><a id="ctl00_TopNavBar_Home" href="https://www.codeproject.com">home</a>
<li class="openable"><a id="ctl00_TopNavBar_Art" class="down selected" href="/script/Articles/Latest.aspx">articles</a>
<ul>
<li class="openable"><a id="ctl00_TopNavBar_ArtTopicList" class="fly" onmouseover="navBarMenu.ShowMap(this, 'ctl00_TopNavBar_MapFlyout');" href="/script/Content/SiteMap.aspx">Chapters and Sections<span class="has-submenu">></span></a><ul id="ctl00_TopNavBar_MapFlyout" class="taxonomy">
<li>
<div id="siteMap"></div>
</li>
</ul>
</li>
<li><a id="ctl00_TopNavBar_ArtLatestArts" class="fly" href="/script/Articles/Latest.aspx?at=1,3,7">Latest Articles</a></li>
<li><a id="ctl00_TopNavBar_ArtTop" class="fly" href="/script/Articles/TopArticles.aspx?ta_so=5">Top Articles</a></li>
<li><a id="ctl00_TopNavBar_ArtGuide" class="fly" href="/info/Submit.aspx">Posting/Update Guidelines</a></li>
<li></li>
<li><a id="ctl00_TopNavBar_ArtPostArticle" class="fly highlight1" href="/script/Articles/Submit.aspx">
<img src="https://codeproject.global.ssl.fastly.net/images/write13.png" width="13px" height="13px" /> Submit an article or tip
</a></li>
<li><a id="ctl00_TopNavBar_ArtPostBlog" class="fly highlight2" href="/script/Articles/BlogFeed.aspx">
<img src="https://codeproject.global.ssl.fastly.net/images/write13.png" width="13px" height="13px" /> Post your Blog
</a></li>		<li class="last"></li>
</ul>
</li>
<li class="openable">
<a id="ctl00_TopNavBar_Answers" href="/script/Answers/List.aspx?tab=active">
<span class="desktop-only tablet-only">quick answers</span><span class="mobile-only">Q&A</span>
</a>
<ul>
<li id="ctl00_TopNavBar_AQL"><a id="ctl00_TopNavBar_ArticleQuestion" class="fly highlight1" href="#_comments">
<img src="https://codeproject.global.ssl.fastly.net/images/write13.png" width="13px" height="13px" /> Ask a Question about this
article</a>
</li>
<li><a id="ctl00_TopNavBar_QAAsk" class="fly highlight2" href="/Questions/ask.aspx"><img
src="https://codeproject.global.ssl.fastly.net/images/write13.png" width="13px" height="13px" /> Ask a Question</a></li>
<li><a id="ctl00_TopNavBar_QAUnanswered" class="fly" href="/script/Answers/List.aspx?tab=unanswered">View Unanswered Questions</a></li>
<li><a id="ctl00_TopNavBar_QALatest" class="fly" href="/script/Answers/List.aspx?tab=active">View All Questions</a></li>
<li><a id="ctl00_TopNavBar_QATR_ctl00_Tag" class="fly" href="/script/Answers/List.aspx?tab=active&alltags=true&tags=81" style="padding-left:30px">View C# questions</a></li>
<li><a id="ctl00_TopNavBar_QATR_ctl01_Tag" class="fly" href="/script/Answers/List.aspx?tab=active&alltags=true&tags=85" style="padding-left:30px">View ASP.NET questions</a></li>
<li><a id="ctl00_TopNavBar_QATR_ctl02_Tag" class="fly" href="/script/Answers/List.aspx?tab=active&alltags=true&tags=842" style="padding-left:30px">View VB.NET questions</a></li>
<li><a id="ctl00_TopNavBar_QATR_ctl03_Tag" class="fly" href="/script/Answers/List.aspx?tab=active&alltags=true&tags=91" style="padding-left:30px">View Java questions</a></li>
<li><a id="ctl00_TopNavBar_QATR_ctl04_Tag" class="fly" href="/script/Answers/List.aspx?tab=active&alltags=true&tags=93" style="padding-left:30px">View SQL questions</a></li>
<li class="last"></li>
</ul>
</li>
<li class="openable"><a id="ctl00_TopNavBar_Forums" href="/script/Forums/List.aspx">
<span class="desktop-only tablet-only">discussions</span><span class="mobile-only">forums</span>
</a>
<ul>
<li><a id="ctl00_TopNavBar_MessageBoardsAll" class="fly" href="/script/Forums/List.aspx">All Message Boards...</a></li>
<li class="openable"><a class="fly" style="padding-left:30px" href="/Forums/1580997/Application-Lifecycle.aspx">Application Lifecycle<span class="has-submenu">></span></a>
<ul class="openable"><li><a class="fly" href="/Forums/1533717/Running-a-Business.aspx">Running a Business</a></li>
<li><a class="fly" href="/Forums/1533716/Sales-Marketing.aspx">Sales / Marketing</a></li>
<li><a class="fly" href="/Forums/1651/Collaboration-Beta-Testing.aspx">Collaboration / Beta Testing</a></li>
<li><a class="fly" href="/Forums/3304/Work-Issues.aspx">Work  Issues</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="/Forums/369270/Design-and-Architecture.aspx">Design and Architecture</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/12076/ASP-NET.aspx">ASP.NET</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1580226/JavaScript.aspx">JavaScript</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="/Forums/1647/C-Cplusplus-MFC.aspx">C / C++ / MFC<span class="has-submenu">></span></a>
<ul class="openable"><li><a class="fly" href="/Forums/4486/ATL-WTL-STL.aspx">ATL /  WTL / STL</a></li>
<li><a class="fly" href="/Forums/3785/Managed-Cplusplus-CLI.aspx">Managed C++/CLI</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1649/Csharp.aspx">C#</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1627782/Free-Tools.aspx">Free Tools</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1827460/Objective-C-and-Swift.aspx">Objective-C and Swift</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1725/Database.aspx">Database</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="/Forums/186301/Hardware-Devices.aspx">Hardware & Devices<span class="has-submenu">></span></a>
<ul class="openable"><li><a class="fly" href="/Forums/1644/System-Admin.aspx">System Admin</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1606152/Hosting-and-Servers.aspx">Hosting and Servers</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1643/Java.aspx">Java</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1650/NET-Framework.aspx">.NET Framework</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1848626/Android.aspx">Android</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1876716/iOS.aspx">iOS</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/13695/Mobile.aspx">Mobile</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1540733/SharePoint.aspx">SharePoint</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1004257/Silverlight-WPF.aspx">Silverlight / WPF</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1646/Visual-Basic.aspx">Visual Basic</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1640/Web-Development.aspx">Web Development</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/suggestions.aspx">Site Bugs / Suggestions</a>
</li>
<li><a class="fly" style="padding-left:30px" href="/Forums/1652005/Spam-and-Abuse-Watch.aspx">Spam and Abuse Watch</a>
</li>
<li class="last"></li>
</ul>
</li>
<li class="openable desktop-only"><a id="ctl00_TopNavBar_Features" href="/Feature/">features</a>
<ul>
<li><a id="ctl00_TopNavBar_Comps" class="fly" href="/script/Contests/CurrentCompetitions.aspx?cmpTpId=3&awsac=true">Competitions</a></li>
<li><a id="ctl00_TopNavBar_News" class="fly" href="/script/News/List.aspx">News</a></li>
<li><a id="ctl00_TopNavBar_Insider" class="fly" href="/Feature/Insider/">The Insider Newsletter</a></li>
<li><a id="ctl00_TopNavBar_DailyBuild" class="fly" href="/Feature/DailyBuild">The Daily Build Newsletter</a></li>
<li><a id="ctl00_TopNavBar_Newsletters" class="fly" href="/script/Mailouts/Archive.aspx?mtpid=1">Newsletter archive</a></li>
<li><a id="ctl00_TopNavBar_Surveys" class="fly" href="/script/Surveys/List.aspx">Surveys</a></li>
<li><a id="ctl00_TopNavBar_Showcase" class="fly" href="/KB/showcase/">Product Showcase</a></li>
<li><a id="ctl00_TopNavBar_Research" class="fly" href="/script/ResearchLibrary/Index.aspx">Research Library</a></li>
<li><a id="ctl00_TopNavBar_Stuff" class="fly" href="/Info/Stuff.aspx">CodeProject Stuff</a></li>
<li class="last"></li>
</ul>
</li>
<li  class="openable"><a id="ctl00_TopNavBar_Lounge" href="/Lounge.aspx">
<span class="desktop-only tablet-only">community</span><span class="mobile-only">lounge</span>
</a>
<ul>
<li><a id="ctl00_TopNavBar_WhosWho" class="fly" href="/script/Membership/Profiles.aspx">Who's Who</a></li>
<li><a id="ctl00_TopNavBar_MVPs" class="fly break" href="/script/Contests/Winners.aspx?obtid=1&cmpTpId=2&cid=0">Most Valuable Professionals</a></li>
<li><a id="ctl00_TopNavBar_LoungeLnk" class="fly highlight2" href="/Lounge.aspx">The Lounge  </a></li>
<li></li>
<li></li>
<li></li>
<li><a id="ctl00_TopNavBar_PRLnk" class="fly break" href="/Forums/1738007/Press-Releases.aspx">Press Releases</a></li>
<li class="openable"><a class="fly" href="/Forums/1580229/Hindi.aspx">Non-English Language
<span class="has-submenu">></span></a>
<ul>
<li><a class="fly" href="/Forums/1580229/Hindi.aspx">General Indian Topics</a></li>
<li><a class="fly" href="/Forums/1580230/Chinese.aspx">General Chinese Topics</a></li>
</ul>
<li class="last"></li>
</ul>
</li>
<li class="openable desktop-only tablet-only" style="margin-left:20px"><a id="ctl00_TopNavBar_Help" href="/KB/FAQs/">help</a>
<ul>
<li><a id="ctl00_TopNavBar_HelpWhatIs" class="fly" href="/info/guide.aspx">What is 'CodeProject'?</a></li>
<li><a id="ctl00_TopNavBar_HelpGeneral" class="fly break" href="/KB/FAQs/">General FAQ</a></li>
<li><a id="ctl00_TopNavBar_HelpPostQuestion" class="fly break highlight2" href="/Questions/ask.aspx">Ask a Question</a></li>
<li><a id="ctl00_TopNavBar_HelpBugs" class="fly" href="/suggestions.aspx">Bugs and Suggestions</a></li>
<li></li>
<li><a id="ctl00_TopNavBar_HelpSiteMap" class="fly" href="/script/Content/SiteMap.aspx">Site Map</a></li>
<li><a id="ctl00_TopNavBar_HelpAdvertise" class="fly" href="http://developermedia.com/">Advertise with us</a></li>
<li><a id="ctl00_TopNavBar_HelpAboutAds" class="fly" href="/info/AboutOurAds.aspx">About our Advertising</a></li>
<li><a id="ctl00_TopNavBar_HelpJobs" class="fly" href="/info/Jobs/">Employment Opportunities</a></li>
<li><a id="ctl00_TopNavBar_HelpAboutUs" class="fly" href="/info/about.aspx">About Us</a></li>
<li class="last"></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sub-headerbar-divider"></div>
</div>
<div id="A" class="container-content-wrap fixed">
<div class="container-content">
<div class="clearfix">
<div class="container-breadcrumb float-left ">
<div><a href="/script/Content/SiteMap.aspx">Articles</a> » <a href="/Chapters/6/General-Programming.aspx">General Programming</a> » <a href="/KB/threads/">Threads, Processes & IPC</a> » <a href="/KB/threads/#Thread+Pooling">Thread Pooling</a></div>
</div>
<div class="float-left">
</div>
<div class="edit-links float-right">
</div>
<div class="article-nav float-right">
<div style="display:inline-block;position:relative;top:-5px;margin-right:20px">
</div>
<span id="ctl00_ActionLinks_BookmarkMd_bookmark" data-type="bookmark" data-ref="2_7933_7" data-size="medium" data-mode="bookmark"></span><a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="/Articles/7933/Smart-Thread-Pool?display=Print">
<img src="/App_Themes/CodeProject/Img/print48.png"
width="24px" height="24px" style="border:0">
</a>
</div>
</div>
<table class="extended container-article-parts" cellpadding="0" cellspacing="0">
<tr valign="top">
<td width="117px" class="article-wing-left">
<div id="ctl00_Nav" class="container-article-tabs">
<div class="tabs">
<div class="selected">Article</div><div class="unselected"><a href="/script/Articles/ViewDownloads.aspx?aid=7933">Browse Code</a></div><div class="unselected"><a href="/script/Articles/Statistics.aspx?aid=7933">Stats</a></div><div class="unselected"><a href="/script/Articles/ListVersions.aspx?aid=7933">Revisions (7)</a></div><div class="unselected"><a href="/script/Articles/ListAlternatives.aspx?aid=7933">Alternatives</a></div>
<div class="unselected"><a href="WebControls/#_comments" id="ctl00_ArticleTabs_CommentLink" class="anchorLink">Comments
<span id="ctl00_ArticleTabs_CmtCnt">(643)</span></a>
</div>
</div>
<a id="ctl00_AddAlternative" title="Write a related article about upgrades or translate this into a different language." class="add-item" href="/script/Articles/SubmissionWizard.aspx?at=1&apid=7933">Add your own<br />alternative version</a>
<div>
<h4>Tagged as</h4>
<span id="ctl00_TagList_TagWrp" class="tags vertical">
<span id="ctl00_TagList_VisibleTags"><div class="t"><a rel="tag" href="/Tags/.NET2.0" data-id="12">.NET2.0</a></div><div class="t"><a rel="tag" href="/Tags/WinXP" data-id="24">WinXP</a></div><div class="t"><a rel="tag" href="/Tags/Win2003" data-id="26">Win2003</a></div><div class="t"><a rel="tag" href="/Tags/VS2005" data-id="39">VS2005</a></div><div class="t"><a rel="tag" href="/Tags/Mono" data-id="62">Mono</a></div><div class="t"><a rel="tag" href="/Tags/.NET3.0" data-id="66">.NET3.0</a></div><div class="t"><a rel="tag" href="/Tags/.NET3.5" data-id="76">.NET3.5</a></div><div class="t"><a rel="tag" href="/Tags/VS2008" data-id="77">VS2008</a></div><div class="t"><a rel="tag" href="/Tags/sharp" data-id="81">C#</a></div><div class="t"><a rel="tag" href="/Tags/Windows" data-id="94">Windows</a></div><div class="t"><a rel="tag" href="/Tags/.NET" data-id="98">.NET</a></div><div class="t"><a rel="tag" href="/Tags/Visual-Studio" data-id="103">Visual-Studio</a></div><div class="t"><a rel="tag" href="/Tags/Win2008" data-id="285">Win2008</a></div><div class="t"><a rel="tag" href="/Tags/Win7" data-id="311">Win7</a></div><div class="t"><a rel="tag" href="/Tags/VS2010" data-id="314">VS2010</a></div></span><acronym id="ctl00_TagList_HiddenTags" title="plus: Win2008-R2, threads, .NET4">, +</acronym>
</span>
</div>
<div class="stats">
<h4>Stats</h4>
<div id="ctl00_ArtStats"><div class="stats"><div>1.6M views</div><div>26.6K downloads</div><div>1.1K bookmarked</div></div></div>
</div>
<div class="subdue padded-top" title="Date First posted">Posted
9 Aug 2004</div>
<div title="Licence">
Licenced <a id="ctl00_LicenseLink" title="The Microsoft Public License (Ms-PL)" class="license" href="http://www.opensource.org/licenses/ms-pl.html">Ms-PL</a>
</div>
</div>
</td>
<td>
<div id="AT" class="container-article  fixed">
<div class="article">
</div>
<div class="bottom-promo">
<div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Thread-Pooling"  data-loadOnView='true'  data-tags='.NET2.0, WinXP, Win2003, VS2005, Mono, .NET3.0, .NET3.5, VS2008, C#, Windows, .NET, Visual-Studio, Dev, Intermediate, Win2008, Win7, VS2010, Win2008-R2, threads, .NET4,rating4.5,pos_bottom'></div>
</div>
<h2 id="ctl00_AlsoRead_RelatedResults_ctl00_Header" class="also-read">You may also be interested in...</h2>
<table class="spaced content-list also-read">
<tr>
<td class="content-list-item" width="50%" valign="top">
<div id="ctl00_AlsoRead_RelatedResults_ctl01_ThumbnailContainer" class="thumbnail">
<a id="ctl00_AlsoRead_RelatedResults_ctl01_Thumbnail" href="//www.codeproject.com/Articles/27358/Extended-Thread-Pool"><img src="/KB/threads/ExtendedThreadPool/Thumb-27358.jpg" alt="" style="border-width:0px;" /></a>
</div>
<div class="text">
<div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl01_Link" href="//www.codeproject.com/Articles/27358/Extended-Thread-Pool">Extended Thread Pool</a></div>
</div>
</td>
<td class="content-list-item" width="50%" valign="top">
<div id="ctl00_AlsoRead_RelatedResults_ctl02_ThumbnailContainer" class="thumbnail">
<a id="ctl00_AlsoRead_RelatedResults_ctl02_Thumbnail" href="//www.codeproject.com/Articles/570682/PDF-File-Writer-Csharp-Class-Library-Version"><img src="/KB/files/570682/Thumbnail.png" alt="" style="border-width:0px;" /></a>
</div>
<div class="text">
<div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl02_Link" href="//www.codeproject.com/Articles/570682/PDF-File-Writer-Csharp-Class-Library-Version">PDF File Writer C# Class Library (Version 1.19.3)</a></div>
</div>
</td>
</tr>
<tr>
<td class="content-list-item" width="50%" valign="top">
<div id="ctl00_AlsoRead_RelatedResults_ctl03_ThumbnailContainer" class="thumbnail">
<a id="ctl00_AlsoRead_RelatedResults_ctl03_Thumbnail" href="//www.codeproject.com/Articles/637708/Thread-Pool"><img src="/KB/cpp/637708/Thumb-637708.png" alt="" style="border-width:0px;" /></a>
</div>
<div class="text">
<div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl03_Link" href="//www.codeproject.com/Articles/637708/Thread-Pool">Thread Pool</a></div>
</div>
</td>
<td class="content-list-item" width="50%" valign="top">
<div id="ctl00_AlsoRead_RelatedResults_ctl04_ThumbnailContainer" class="thumbnail">
<a id="ctl00_AlsoRead_RelatedResults_ctl04_Thumbnail" href="//www.codeproject.com/Articles/3607/Work-Queue"><img src="/KB/threads/work_queue/Thumb-3607.gif" alt="" style="border-width:0px;" /></a>
</div>
<div class="text">
<div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl04_Link" href="//www.codeproject.com/Articles/3607/Work-Queue">Work Queue</a></div>
</div>
</td>
</tr>
<tr>
<td class="content-list-item" width="50%" valign="top">
<div id="ctl00_AlsoRead_RelatedResults_ctl05_ThumbnailContainer" class="thumbnail">
<a id="ctl00_AlsoRead_RelatedResults_ctl05_Thumbnail" href="//www.codeproject.com/Articles/1250050/DirectX-and-Pure-Assembly-Language-Doing-What-Ca"><img src="https://codeproject.global.ssl.fastly.net/script/Articles/Images/article100x80.png" alt="" style="border-width:0px;" /></a>
</div>
<div class="text">
<div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl05_Link" href="//www.codeproject.com/Articles/1250050/DirectX-and-Pure-Assembly-Language-Doing-What-Ca">DirectX and Pure Assembly Language: Doing What Can't be Done - Part IV(b): the Full DirectX App</a></div>
</div>
</td>
<td class="content-list-item" width="50%" valign="top">
<div id="ctl00_AlsoRead_RelatedResults_ctl06_ThumbnailContainer" class="thumbnail">
<a id="ctl00_AlsoRead_RelatedResults_ctl06_Thumbnail" href="//www.codeproject.com/Articles/733/A-programming-model-to-use-a-thread-pool"><img src="https://codeproject.global.ssl.fastly.net/script/Articles/Images/article100x80.png" alt="" style="border-width:0px;" /></a>
</div>
<div class="text">
<div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl06_Link" href="//www.codeproject.com/Articles/733/A-programming-model-to-use-a-thread-pool">A programming model to use a thread pool</a></div>
</div>
</td>
</tr>
</table>
<h2>Comments and Discussions</h2>
<a class="float-left" name="_comments" id="_comments"> </a><div id="_MessageBoardctl00_MessageBoard" onclick="return forumControl36716156.SwitchMessage(event, null)">
<table id="ForumTable" class="forum relaxed" cellpadding="0" cellspacing="0">
<tr>
<td class="header1"><div class="callout">
<b>You must <a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f7933%2fSmart-Thread-Pool%3ffid%3d88599%26df%3d90%26mpp%3d25%26prof%3dTrue%26sort%3dPosition%26view%3dNormal%26spc%3dRelaxed">Sign In</a> to use this message board.</b>
</div></td>
</tr><tr>
<td><table width="100%" border="0" cellpadding="3px" cellspacing="0">
<tr class="header1">
<td colspan="2" style="white-space:nowrap;"><div class="container">
<div class="float-right">
</div>
</div></td>
</tr><tr class="header2">
<td></td><td style="width:100%;"><div style="text-align:right;">
</div></td>
</tr>
</table></td>
</tr><tr>
<td><a name="xx0xx"></a><table border="0" cellpadding="2px" cellspacing="0" width="100%">
<tr class="navbar">
<td></td><td style="text-align:right;width:50%;"></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link disabled">First</span> <span class="nav-link disabled">Prev</span><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&prof=True&sort=Position&view=Normal&spc=Relaxed&fr=26#xx0xx">Next</a></td>
</tr>
</table></td>
</tr><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%" class="fixed-layout blank-background">
<tr id="F5437524_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx5437524xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="5437524" parent="0" thread="5437524" href="/Messages/5437524/The-best-Thread-pool-class-for-NET-Developers.aspx">The best Thread pool class for .NET Developers</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Yuval Naveh</span><span class="date">22-Sep-17  5:19</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=20025">Yuval Naveh</a></span></td><td class="date"><span>22-Sep-17  5:19 </span></td>
</tr>
</table></td>
</tr><tr id="F5437524_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="20025" msgid="5437524" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Ami,<br />
I have been using STP for many years. Great work.<br />
<br />
My only feedback: Please provide a proper wiki style reference guide documentation in the github site.<br />
<br />
Thanks,<br />
Yuval<br />
<div class="signature">"The true sign of intelligence is not knowledge but imagination." - Albert Einstein</div><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=5437524" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5437524" data-ref="3_5437524" class="rating-label" name="RateItem_5437524"><span class="rating-result"><span></span></span></span><a href="/Messages/5437524/The-best-Thread-pool-class-for-NET-Developers.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F5346904_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx5346904xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="5346904" parent="0" thread="5346904" href="/Messages/5346904/SmartThreadPool-Timeout-Taking-Almost-Minutes-to-F.aspx">SmartThreadPool Timeout Taking Almost 2 Minutes to Free Threads</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Member 8704722</span><span class="date">9-Jan-17  10:01</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=8704722">Member 8704722</a></span></td><td class="date"><span>9-Jan-17  10:01 </span></td>
</tr>
</table></td>
</tr><tr id="F5346904_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="8704722" msgid="5346904" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">I'm using SmartThreadPool to run background jobs. We've decided to put in a timeout so that, if the job hasn't completed after a set amount of time, it will be cancelled. When that happens, the goal is for the thread to become available again for other jobs. That seems to happen, but it takes a few minutes after the timeout has expired for the thread to become available again. Is there any way to speed that up? <br />
<br />
Here's my test program that demonstrates the issue:<br />
<pre lang="" data-lang-guess="C#"><span class="code-keyword">using</span> Amib.Threading;
<span class="code-keyword">using</span> System;
<span class="code-keyword">using</span> System.Collections.Generic;
<span class="code-keyword">using</span> System.Linq;
<span class="code-keyword">using</span> System.Text;
<span class="code-keyword">using</span> System.Threading;
<span class="code-keyword">using</span> System.Threading.Tasks;
<span class="code-keyword">namespace</span> TestSmartThreadPoolTimeouts1
{
<span class="code-keyword">public</span> <span class="code-keyword">class</span> Program
{
<span class="code-keyword">static</span> SmartThreadPool pool;
<span class="code-keyword">static</span> <span class="code-keyword">int</span> state = <span class="code-digit">6</span>;
<span class="code-keyword">static</span> <span class="code-keyword">void</span> Main(<span class="code-keyword">string</span>[] args)
{
pool = <span class="code-keyword">new</span> SmartThreadPool();
pool.MaxThreads = <span class="code-digit">1</span>;
<span class="code-keyword">string</span> state1 = <span class="code-string">"</span><span class="code-string">thisIsState1"</span>;
<span class="code-keyword">string</span> state2 = <span class="code-string">"</span><span class="code-string">thisIsState2"</span>;
<span class="code-keyword">string</span> state3 = <span class="code-string">"</span><span class="code-string">thisIsState3"</span>;
<span class="code-keyword">string</span> state4 = <span class="code-string">"</span><span class="code-string">thisIsState4"</span>;
<span class="code-keyword">string</span> state5 = <span class="code-string">"</span><span class="code-string">thisIsState5"</span>;
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Threads before queueing: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads);
pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
Timeout = <span class="code-digit">400</span>, <span class="code-comment">//</span><span class="code-comment"> 921600000 - 256 hours</span>
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunLongJob),
(<span class="code-keyword">object</span>)state1
);
pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
Timeout = <span class="code-digit">400</span>, <span class="code-comment">//</span><span class="code-comment"> 921600000 - 256 hours</span>
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)state2
);
pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
Timeout = <span class="code-digit">400</span>, <span class="code-comment">//</span><span class="code-comment"> 921600000 - 256 hours</span>
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)state3
);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Threads after queueing L1, S2 and S3: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads + <span class="code-string">"</span><span class="code-string">, Waiting: "</span> + pool.WaitingCallbacks);
Thread.Sleep(<span class="code-digit">1000</span>);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - After waiting twice the timeout (long enough for the long job to cancel and for multiple short jobs to then complete: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads + <span class="code-string">"</span><span class="code-string">, Waiting: "</span> + pool.WaitingCallbacks);
pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
Timeout = <span class="code-digit">400</span>, <span class="code-comment">//</span><span class="code-comment"> 921600000 - 256 hours</span>
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)state4
);
pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
Timeout = <span class="code-digit">400</span>, <span class="code-comment">//</span><span class="code-comment"> 921600000 - 256 hours</span>
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)state5
);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - After queueing S4 and S5"</span>);
Thread.Sleep(<span class="code-digit">2000</span>);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - After waiting 1000, long enough for all short jobs to complete: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads + <span class="code-string">"</span><span class="code-string">, Waiting: "</span> + pool.WaitingCallbacks);
Console.ReadLine();
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">object</span> RunLongJob(<span class="code-keyword">object</span> state)
{
Thread.Sleep(<span class="code-digit">100000</span>);
<span class="code-keyword">return</span> <span class="code-digit">1</span>;
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">object</span> RunShortJob(<span class="code-keyword">object</span> state)
{
Thread.Sleep(<span class="code-digit">100</span>);
<span class="code-keyword">return</span> <span class="code-digit">2</span>;
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">void</span> PostExecCallback(IWorkItemResult result)
{
<span class="code-keyword">try</span>
{
<span class="code-keyword">if</span> (result.IsCanceled)
{
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - State "</span> + result.State.ToString() + <span class="code-string">"</span><span class="code-string"> is canceled: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads);
pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
Timeout = <span class="code-digit">400</span>, <span class="code-comment">//</span><span class="code-comment"> 921600000 - 256 hours</span>
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)state
);
state++;
}
<span class="code-keyword">else</span>
{
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Job Completed, State: "</span> + result.State.ToString() + <span class="code-string">"</span><span class="code-string">, Result: "</span> + result.GetResult());
}
}
<span class="code-keyword">catch</span>(WorkItemCancelException exc)
{
<span class="code-keyword">object</span> a = result.State;
<span class="code-keyword">bool</span> isComplete = result.IsCompleted;
Console.WriteLine(<span class="code-string">"</span><span class="code-string">State "</span> + result.State.ToString() + <span class="code-string">"</span><span class="code-string"> is in exception: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads);
}
}
}
}
</pre>
<br />
and here is the initial output of that program:<br />
<pre lang="" data-lang-guess="C#">1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">50</span>:<span class="code-digit">35</span> PM - Threads before queueing: <span class="code-digit">0</span>, In Use Threads: <span class="code-digit">0</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">50</span>:<span class="code-digit">35</span> PM - Threads after queueing L1, S2 and S3: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">0</span>, Waiting: <span class="code-digit">3</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">50</span>:<span class="code-digit">36</span> PM - After waiting twice the timeout (<span class="code-keyword">long</span> enough <span class="code-keyword">for</span> the <span class="code-keyword">long</span> job to cancel and <span class="code-keyword">for</span> multiple <span class="code-keyword">short</span> jobs to then complete: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>, Waiting: <span class="code-digit">2</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">50</span>:<span class="code-digit">36</span> PM - After queueing S4 and S5
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">50</span>:<span class="code-digit">38</span> PM - After waiting <span class="code-digit">1000</span>, <span class="code-keyword">long</span> enough <span class="code-keyword">for</span> all <span class="code-keyword">short</span> jobs to complete: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>, Waiting: <span class="code-digit">4</span>
</pre>
<br />
And when I let the program sit for a couple of minutes after the last line had printed, these lines additionally appear:<br />
<pre lang="" data-lang-guess="C#">1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - State thisIsState1 <span class="code-keyword">is</span> canceled: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - State thisIsState2 <span class="code-keyword">is</span> canceled: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - State thisIsState3 <span class="code-keyword">is</span> canceled: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - State thisIsState4 <span class="code-keyword">is</span> canceled: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - State thisIsState5 <span class="code-keyword">is</span> canceled: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - Job Completed, State: <span class="code-digit">6</span>, Result: <span class="code-digit">2</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - Job Completed, State: <span class="code-digit">7</span>, Result: <span class="code-digit">2</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - Job Completed, State: <span class="code-digit">8</span>, Result: <span class="code-digit">2</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - State <span class="code-digit">9</span> <span class="code-keyword">is</span> canceled: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - State <span class="code-digit">10</span> <span class="code-keyword">is</span> canceled: <span class="code-digit">1</span>, In Use Threads: <span class="code-digit">1</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - Job Completed, State: <span class="code-digit">11</span>, Result: <span class="code-digit">2</span>
1/9/2017 <span class="code-digit">2</span>:<span class="code-digit">52</span>:<span class="code-digit">15</span> PM - Job Completed, State: <span class="code-digit">12</span>, Result: <span class="code-digit">2</span>
</pre>
<br />
That output makes sense, but only if a cancelled thread takes almost 2 full seconds to become available for additional jobs. Given that the timeout is only 400ms, that seems like a lot of time to wait to get the thread back. Is there some way to modify that so that threads are reused sooner after a timeout?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=5346904" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5346904" data-ref="3_5346904" class="rating-label" name="RateItem_5346904"><span class="rating-result"><span></span></span></span><a href="/Messages/5346904/SmartThreadPool-Timeout-Taking-Almost-Minutes-to-F.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F5419223_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="38px" class="indent"><a name="xx5419223xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_answer.gif" alt="Answer" title="Answer" /></td><td class="subject hover-container"><a class="message-link" name="5419223" parent="5346904" thread="5346904" href="/Messages/5419223/Re-SmartThreadPool-Timeout-Taking-Almost-Minutes-t.aspx">Re: SmartThreadPool Timeout Taking Almost 2 Minutes to Free Threads</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">sajeoiweoryhhfer9</span><span class="date">25-Jul-17  23:54</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=1107308">sajeoiweoryhhfer9</a></span></td><td class="date"><span>25-Jul-17  23:54 </span></td>
</tr>
</table></td>
</tr><tr id="F5419223_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="1107308" msgid="5419223" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return forumControl36716156.SwitchMessage(null,5346904);" href="/Messages/5346904/SmartThreadPool-Timeout-Taking-Almost-Minutes-to-F.aspx"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/arrow-up24.png" title="Go to Parent"  style="width:16px;height:16px;border:0" /></a></div>Why don't you just handle it in the worker? Yes, you need to create one more thread for this, I know..<br />
But I feel like the Timeout has other reasoning behind.<br />
I made some changes in your code to be closer to what I need, but maybe it helps somebody...<br />
<pre lang="c#"><span class="code-keyword">using</span> Amib.Threading;
<span class="code-keyword">using</span> System;
<span class="code-keyword">using</span> System.Threading;
<span class="code-keyword">namespace</span> TestSmartThreadPoolTimeouts1
{
<span class="code-keyword">public</span> <span class="code-keyword">class</span> Program
{
<span class="code-keyword">static</span> SmartThreadPool pool;
<span class="code-keyword">static</span> <span class="code-keyword">void</span> Main(<span class="code-keyword">string</span>[] args)
{
pool = <span class="code-keyword">new</span> SmartThreadPool();
pool.MaxThreads = <span class="code-digit">1</span>;
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Threads before queueing: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads);
StateHelper sh;
sh = <span class="code-keyword">new</span> StateHelper(<span class="code-string">"</span><span class="code-string">1"</span>, <span class="code-digit">5000</span>);
sh.IWIR = pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunLongJob),
(<span class="code-keyword">object</span>)sh
);
sh = <span class="code-keyword">new</span> StateHelper(<span class="code-string">"</span><span class="code-string">2"</span>);
sh.IWIR = pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)sh
);
sh = <span class="code-keyword">new</span> StateHelper(<span class="code-string">"</span><span class="code-string">3"</span>);
sh.IWIR = pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)sh
);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Threads after queueing L1, S2 and S3: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads + <span class="code-string">"</span><span class="code-string">, Waiting: "</span> + pool.WaitingCallbacks);
Thread.Sleep(<span class="code-digit">1000</span>);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - After sleep 1000"</span>);
sh = <span class="code-keyword">new</span> StateHelper(<span class="code-string">"</span><span class="code-string">4"</span>);
sh.IWIR = pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)sh
);
sh = <span class="code-keyword">new</span> StateHelper(<span class="code-string">"</span><span class="code-string">5"</span>);
sh.IWIR = pool.QueueWorkItem(
<span class="code-keyword">new</span> WorkItemInfo()
{
PostExecuteWorkItemCallback = <span class="code-keyword">new</span> PostExecuteWorkItemCallback(PostExecCallback),
},
<span class="code-keyword">new</span> WorkItemCallback(RunShortJob),
(<span class="code-keyword">object</span>)sh
);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - After queueing S4 and S5"</span>);
<span class="code-keyword">while</span> (pool.InUseThreads <span class="code-keyword">></span> <span class="code-digit">0</span>)
{
Thread.Sleep(<span class="code-digit">1000</span>);
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Active threads: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads + <span class="code-string">"</span><span class="code-string">, Waiting: "</span> + pool.WaitingCallbacks);
}
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - All workers have ended, press ENTER to close"</span>);
Console.ReadLine();
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">object</span> RunLongJob(<span class="code-keyword">object</span> state)
{
<span class="code-keyword">try</span>
{
((StateHelper)state).DT = DateTime.Now;
Thread worker = <span class="code-keyword">new</span> Thread(() =<span class="code-keyword">></span>
{
Thread.CurrentThread.IsBackground = <span class="code-keyword">true</span>;
Thread.Sleep(<span class="code-digit">100000</span>);
});
worker.Start();
<span class="code-keyword">if</span> (((StateHelper)state).Timeout <span class="code-keyword">></span> <span class="code-digit">0</span>)
{
<span class="code-keyword">bool</span> finished = worker.Join(((StateHelper)state).Timeout);
<span class="code-keyword">if</span> (!finished)
worker.Abort();
<span class="code-keyword">if</span> (!finished)
((StateHelper)state).IWIR.Cancel();
}
}
<span class="code-keyword">catch</span> (Exception)
{ }
<span class="code-keyword">return</span> <span class="code-digit">1</span>;
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">object</span> RunShortJob(<span class="code-keyword">object</span> state)
{
((StateHelper)state).DT = DateTime.Now;
Thread.Sleep(<span class="code-digit">100</span>);
<span class="code-keyword">return</span> <span class="code-digit">2</span>;
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">void</span> PostExecCallback(IWorkItemResult result)
{
<span class="code-keyword">try</span>
{
<span class="code-keyword">if</span> (result.IsCanceled)
{
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Job Cancelled, was active: "</span> + (DateTime.Now - ((StateHelper)result.State).DT));
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - State "</span> + result.State.ToString() + <span class="code-string">"</span><span class="code-string"> is canceled: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads);
}
<span class="code-keyword">else</span>
{
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - Job Completed, was active: "</span> + (DateTime.Now - ((StateHelper)result.State).DT));
Console.WriteLine(DateTime.Now.ToString() + <span class="code-string">"</span><span class="code-string"> - State  "</span> + result.State.ToString() + <span class="code-string">"</span><span class="code-string"> has completed, Result: "</span> + result.GetResult());
}
}
<span class="code-keyword">catch</span> (WorkItemCancelException)
{
<span class="code-keyword">object</span> a = result.State;
<span class="code-keyword">bool</span> isComplete = result.IsCompleted;
Console.WriteLine(<span class="code-string">"</span><span class="code-string">State "</span> + result.State.ToString() + <span class="code-string">"</span><span class="code-string"> is in exception: "</span> + pool.ActiveThreads + <span class="code-string">"</span><span class="code-string">, In Use Threads: "</span> + pool.InUseThreads);
}
}
}
<span class="code-keyword">public</span> <span class="code-keyword">class</span> StateHelper
{
<span class="code-keyword">public</span> StateHelper(<span class="code-keyword">string</span> info, <span class="code-keyword">int</span> timeout = <span class="code-digit">0</span>)
{
Info = info;
Timeout = timeout;
}
<span class="code-keyword">public</span> DateTime DT { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }
<span class="code-keyword">public</span> IWorkItemResult IWIR { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }
<span class="code-keyword">public</span> <span class="code-keyword">string</span> Info { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }
<span class="code-keyword">public</span> <span class="code-keyword">int</span> Timeout { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }
<span class="code-keyword">public</span> <span class="code-keyword">override</span> <span class="code-keyword">string</span> ToString()
{
<span class="code-keyword">return</span> Info;
}
}
}</pre><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=5346904" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5419223" data-ref="3_5419223" class="rating-label" name="RateItem_5419223"><span class="rating-result"><span></span></span></span><a href="/Messages/5419223/Re-SmartThreadPool-Timeout-Taking-Almost-Minutes-t.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F5073866_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx5073866xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="5073866" parent="0" thread="5073866" href="/Messages/5073866/Please-share-any-comparison-against-NET-ThreadPool.aspx">Please share any comparison against .NET4.0 ThreadPool, performance etc?</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">KesavanandChavali</span><span class="date">12-Jun-15  7:55</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=10905208">KesavanandChavali</a></span></td><td class="date"><span>12-Jun-15  7:55 </span></td>
</tr>
</table></td>
</tr><tr id="F5073866_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="10905208" msgid="5073866" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Please share any comparison against .NET4.0 ThreadPool, performance etc?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=5073866" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5073866" data-ref="3_5073866" class="rating-label" name="RateItem_5073866"><span class="rating-result"><span></span></span></span><a href="/Messages/5073866/Please-share-any-comparison-against-NET-ThreadPool.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F5030207_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx5030207xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="5030207" parent="0" thread="5030207" href="/Messages/5030207/What-I-needed-and-so-much-more.aspx">What I needed and so much more...</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">setigamer</span><span class="date">27-Mar-15  21:54</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-pro-16.png" title="professional" alt="professional" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=1661654">setigamer</a></span></td><td class="date"><span>27-Mar-15  21:54 </span></td>
</tr>
</table></td>
</tr><tr id="F5030207_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="1661654" msgid="5030207" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Absolutely fantastic article and code. I'm not a novice to coding but was never strong with threading, your well thought out explanations are articulate and were easy to comprehend.<br />
<br />
Thank you VERY much!!!<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=5030207" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5030207" data-ref="3_5030207" class="rating-label" name="RateItem_5030207"><span class="rating-result"><span></span></span></span><a href="/Messages/5030207/What-I-needed-and-so-much-more.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F5028519_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx5028519xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="5028519" parent="0" thread="5028519" href="/Messages/5028519/Using-SmartThread-with-STA-and-event-driven-enviro.aspx">Using SmartThread with STA and event driven enviroment.</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Sadanand Reddy</span><span class="date">26-Mar-15  0:10</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=11532399">Sadanand Reddy</a></span></td><td class="date"><span>26-Mar-15  0:10 </span></td>
</tr>
</table></td>
</tr><tr id="F5028519_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="11532399" msgid="5028519" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hi I have a use case where I am supposed to use C# Web Browser inside a form and get some data from it. However as we know the C# browser runs under STA hence I have created an instance of SmartThread with single thread architecture. <br />
<br />
On some events from an MVC app I am supposed to invoke the web browser and get the result. When the browser is instantiated at that moment I can invoke any JavaScript method, however when I wait for an event in MVC and invoke on event the SmartThread doesn't seems to invoke the webbrowser.<br />
<br />
Here is my below code please help me.<br />
<br />
<pre lang="cs"><span class="code-keyword">public</span> <span class="code-keyword">class</span> FormBrowser
{
<span class="code-keyword">public</span> <span class="code-keyword">static</span> Form1 form1 = <span class="code-keyword">null</span>;
<span class="code-keyword">public</span> <span class="code-keyword">static</span> SmartThreadPool smartThreadPool;
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">void</span> initialise()
{
<span class="code-keyword">if</span> (smartThreadPool == <span class="code-keyword">null</span>)
{
STPStartInfo stpStartInfo = <span class="code-keyword">new</span> STPStartInfo();
stpStartInfo.StartSuspended = <span class="code-keyword">true</span>;
stpStartInfo.ApartmentState = ApartmentState.STA;
stpStartInfo.MaxWorkerThreads = <span class="code-digit">1</span>;
smartThreadPool = <span class="code-keyword">new</span> SmartThreadPool(stpStartInfo);
<span class="code-keyword">var</span> ab = smartThreadPool.QueueWorkItem(<span class="code-keyword">new</span> WorkItemCallback(initForm), <span class="code-string">"</span><span class="code-string">line"</span>);
smartThreadPool.Start();
<span class="code-comment">//</span><span class="code-comment">smartThreadPool.Shutdown();</span>
}
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">object</span> initForm(<span class="code-keyword">object</span> msg)
{
<span class="code-keyword">var</span> id = Thread.CurrentThread.ManagedThreadId;
form1 = <span class="code-keyword">new</span> Form1();
System.Windows.Forms.Application.Run(form1);
<span class="code-keyword">return</span> <span class="code-keyword">null</span>;
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">void</span> redraw()
{
<span class="code-keyword">var</span> id = Thread.CurrentThread.ManagedThreadId;
smartThreadPool.QueueWorkItem(<span class="code-keyword">new</span> WorkItemCallback(rd), <span class="code-string">"</span><span class="code-string">line"</span>);
}
<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">object</span> rd(<span class="code-keyword">object</span> msg)
{
<span class="code-keyword">var</span> id = Thread.CurrentThread.ManagedThreadId;
form1.webBrowser1.Document.InvokeScript(<span class="code-string">"</span><span class="code-string">startDrawing"</span>);
<span class="code-keyword">return</span> <span class="code-keyword">null</span>;
}
}</pre><br />
<br />
<br />
This is class where I am creating a Form by calling method <pre data-lang-guess="C#">initialise();</pre><br />
<br />
But when I call the method <pre data-lang-guess="C#">redraw();</pre> on an event say client requests for a particular page. This line doesn't seem to do any call to method rd <br />
<br />
<pre data-lang-guess="C#">smartThreadPool.QueueWorkItem(<span class="code-keyword">new</span> WorkItemCallback(rd), <span class="code-string">"</span><span class="code-string">line"</span>);</pre><br />
<br />
Am I missing something or this is not supported please help me solve this issue.<br />
If you need the whole project I can upload to git and provide the same.<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=5028519" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5028519" data-ref="3_5028519" class="rating-label" name="RateItem_5028519"><span class="rating-result"><span></span></span></span><a href="/Messages/5028519/Using-SmartThread-with-STA-and-event-driven-enviro.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F5004568_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx5004568xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="5004568" parent="0" thread="5004568" href="/Messages/5004568/Windows.aspx">Windows 10</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">kiquenet.com</span><span class="date">18-Feb-15  2:34</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=3595275">kiquenet.com</a></span></td><td class="date"><span>18-Feb-15  2:34 </span></td>
</tr>
</table></td>
</tr><tr id="F5004568_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="3595275" msgid="5004568" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Will be support for Windows 10? futures roadmap or updates for VS 2015, Windows 10 ?<br />
<div class="signature">kiquenet.com</div><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=5004568" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5004568" data-ref="3_5004568" class="rating-label" name="RateItem_5004568"><span class="rating-result"><span></span></span></span><a href="/Messages/5004568/Windows.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4957138_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4957138xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4957138" parent="0" thread="4957138" href="/Messages/4957138/SmartThreadPool-and-Mono-possible-issue.aspx">SmartThreadPool and Mono possible issue?</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">pasashnikov</span><span class="date">4-Dec-14  15:25</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=6420754">pasashnikov</a></span></td><td class="date"><span>4-Dec-14  15:25 </span></td>
</tr>
</table></td>
</tr><tr id="F4957138_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="6420754" msgid="4957138" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">I have an application build with SmartThreadPool and it works fine under .Net, and completes in about 15 minutes.<br />
However when I tried to run it under linux mono, performanceis terrible - I waited 2 hours and it was still running.<br />
I tried under Windows Mono and the same issue here as well.<br />
<br />
Could your advice on what can be wrong?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4957138" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4957138" data-ref="3_4957138" class="rating-label" name="RateItem_4957138"><span class="rating-result"><span></span></span></span><a href="/Messages/4957138/SmartThreadPool-and-Mono-possible-issue.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4954272_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4954272xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4954272" parent="0" thread="4954272" href="/Messages/4954272/Is-STP-using-the-static-ThreadPool.aspx">Is STP using the static ThreadPool.</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Member 11215864</span><span class="date">1-Dec-14  9:33</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=11215864">Member 11215864</a></span></td><td class="date"><span>1-Dec-14  9:33 </span></td>
</tr>
</table></td>
</tr><tr id="F4954272_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="11215864" msgid="4954272" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">First of all, would like to complement the work. Thanks a lot, SmarthThreadPool does a great job.<br />
Just one questions:<br />
With the STP, I am also using the Static ThreadPool with ThreadPool.SetMaxThreads = X. Will this impact the STP? I mean if STP is using the static one under-need, then by limiting the static one, I may indirectly limit the STP?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4954272" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4954272" data-ref="3_4954272" class="rating-label" name="RateItem_4954272"><span class="rating-result"><span></span></span></span><a href="/Messages/4954272/Is-STP-using-the-static-ThreadPool.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F5002714_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="38px" class="indent"><a name="xx5002714xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_answer.gif" alt="Answer" title="Answer" /></td><td class="subject hover-container"><a class="message-link" name="5002714" parent="4954272" thread="4954272" href="/Messages/5002714/Re-Is-STP-using-the-static-ThreadPool.aspx">Re: Is STP using the static ThreadPool.</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Ami Bar</span><span class="date">16-Feb-15  2:33</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=933414">Ami Bar</a></span></td><td class="date"><span>16-Feb-15  2:33 </span></td>
</tr>
</table></td>
</tr><tr id="F5002714_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="933414" msgid="5002714" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return forumControl36716156.SwitchMessage(null,4954272);" href="/Messages/4954272/Is-STP-using-the-static-ThreadPool.aspx"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/arrow-up24.png" title="Go to Parent"  style="width:16px;height:16px;border:0" /></a></div>No it doesn't use it.<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4954272" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF5002714" data-ref="3_5002714" class="rating-label" name="RateItem_5002714"><span class="rating-result"><span></span></span></span><a href="/Messages/5002714/Re-Is-STP-using-the-static-ThreadPool.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4871438_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4871438xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4871438" parent="0" thread="4871438" href="/Messages/4871438/VB-Examples.aspx">VB Examples?</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">cknipe</span><span class="date">29-Jul-14  2:40</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=2489904">cknipe</a></span></td><td class="date"><span>29-Jul-14  2:40 </span></td>
</tr>
</table></td>
</tr><tr id="F4871438_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="2489904" msgid="4871438" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hi,<br />
<br />
Brilliant work and I am *really* keen to use this.  It does, exactly, what I require  <img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/smiley_laugh.gif" align="top" alt="Laugh | :laugh:" />  <br />
<br />
But alas.  Unless I've missed it there's no real documentation that comes with this, and all the examples are in C#  <img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/smiley_cry.gif" align="top" alt="Cry | :((" />  <br />
<br />
Does anyone perhaps have a very simplistic example in VB to create the pool, and give it work to do?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4871438" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4871438" data-ref="3_4871438" class="rating-label" name="RateItem_4871438"><span class="rating-result"><span></span></span></span><a href="/Messages/4871438/VB-Examples.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4867081_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4867081xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4867081" parent="0" thread="4867081" href="/Messages/4867081/Suggestion.aspx">Suggestion</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Osten</span><span class="date">23-Jul-14  4:19</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=5029966">Osten</a></span></td><td class="date"><span>23-Jul-14  4:19 </span></td>
</tr>
</table></td>
</tr><tr id="F4867081_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="5029966" msgid="4867081" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Just a tip. You should include the namespace to use <img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/smiley_smile.gif" align="top" alt="Smile | :)" /> <br />
<div class="signature">boolean dontNotCancel = ((!false && true) != (!true || false)) ? ((false == false || (true && (false == true ? true : false))) ? true : false) : (true != false && false);</div><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4867081" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4867081" data-ref="3_4867081" class="rating-label" name="RateItem_4867081"><span class="rating-result"><span></span></span></span><a href="/Messages/4867081/Suggestion.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4799756_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4799756xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4799756" parent="0" thread="4799756" href="/Messages/4799756/IWorkItemResult-lt-T-gt-Exception-InvalidCastExcep.aspx">IWorkItemResult<T>.Exception InvalidCastException</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Member 1408507</span><span class="date">13-Apr-14  23:06</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=1408507">Member 1408507</a></span></td><td class="date"><span>13-Apr-14  23:06 </span></td>
</tr>
</table></td>
</tr><tr id="F4799756_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="1408507" msgid="4799756" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hi,<br />
when I try to use IWorkItemResult<t>.Exception, I am getting a System.InvalidCastException:<br />
<br />
I have<br />
<pre lang="c#">IWorkItemResult<FooType> workItemResult;</pre><br />
<br />
I call ExceptionMethod method defined in FooThread class<br />
<pre lang="c#"><span class="code-keyword">public</span> FooType ExceptionMethod(<span class="code-keyword">int</span> i, <span class="code-keyword">string</span> s)
{
<span class="code-keyword">throw</span> <span class="code-keyword">new</span> NotImplementedException(<span class="code-string">"</span><span class="code-string">General exception example"</span>);
}</pre><br />
<br />
with<br />
<pre lang="c#">workItemResult = smartThreadPool.QueueWorkItem(<span class="code-keyword">new</span> Amib.Threading.Func<int, <span class="code-keyword">string</span>, FooType>(fooThread.ExceptionMethod), <span class="code-digit">2</span>, <span class="code-string">"</span><span class="code-string">Hello, world"</span>)</pre><br />
<br />
When I use<br />
<pre lang="c#"><span class="code-keyword">if</span> (workItemResult.Exception != <span class="code-keyword">null</span>) ...</pre><br />
<br />
i get<br />
<pre lang="text">System.InvalidCastException: Unable to cast object of type 'System.NotImplementedException' to type 'SmartThreadPoolPoC.FooType'.</pre><br />
<br />
Note: FooType is a simple type:<br />
<pre lang="c#"><span class="code-keyword">public</span> <span class="code-keyword">class</span> FooType
{
<span class="code-keyword">public</span> <span class="code-keyword">int</span> FooNumber { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }
<span class="code-keyword">public</span> DateTime FooDate { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }
}</pre><br />
<br />
Am I doing something wrong?<br />
<br />
thanks<br />
Zdenek<br />
<div class="signature">zkul1</div><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4799756" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4799756" data-ref="3_4799756" class="rating-label" name="RateItem_4799756"><span class="rating-result"><span></span></span></span><a href="/Messages/4799756/IWorkItemResult-lt-T-gt-Exception-InvalidCastExcep.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4789076_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4789076xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4789076" parent="0" thread="4789076" href="/Messages/4789076/Shutting-down-a-threadpool-with-a-large-queue-work.aspx">Shutting down a threadpool with a large queue works, but it hangs the thread waiting on threadPool.WaitForIdle()</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">MrBic</span><span class="date">28-Mar-14  12:17</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=1480971">MrBic</a></span></td><td class="date"><span>28-Mar-14  12:17 </span></td>
</tr>
</table></td>
</tr><tr id="F4789076_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="1480971" msgid="4789076" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">I have a windows Service that is using the SmartThreadPool.<br />
<br />
I have the SmartThreadPool as a class level object.<br />
The windows service starts a new thread to do the work. Inside this thread I instantiate the SmartThreadPool and give is around 200,000 items to do. These items take 1-5 seconds to finish. If I decide to "stop" my service at any time it will call ShutDown() on the SmartThreadPool.<br />
<br />
When Shutdown() is called, all active threads are gone, active threads are 0. The issue I have is the Worker thread in the service is still STUCK at: threadPool.WaitForIdle();<br />
<br />
if I put a manual loop at that spot it works. Shouldn't ShutDown() make all threads idle?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4789076" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4789076" data-ref="3_4789076" class="rating-label" name="RateItem_4789076"><span class="rating-result"><span></span></span></span><a href="/Messages/4789076/Shutting-down-a-threadpool-with-a-large-queue-work.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4783907_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4783907xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4783907" parent="0" thread="4783907" href="/Messages/4783907/How-to-pause-SmartThreadPool.aspx">How to pause SmartThreadPool</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">imgen</span><span class="date">21-Mar-14  4:14</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=1674139">imgen</a></span></td><td class="date"><span>21-Mar-14  4:14 </span></td>
</tr>
</table></td>
</tr><tr id="F4783907_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="1674139" msgid="4783907" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">I am using SmartThreadPool in my little app, it's quite easy to use. But there is one caveat, I want to pause the STP, meaning stop dequeuing work items. And later on resume STP, meaning start dequeuing work items again. You stated that this feature is added, but I could not figure it out. Could you help me out?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4783907" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4783907" data-ref="3_4783907" class="rating-label" name="RateItem_4783907"><span class="rating-result"><span></span></span></span><a href="/Messages/4783907/How-to-pause-SmartThreadPool.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4778825_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4778825xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_general.gif" alt="General" title="General" /></td><td class="subject hover-container"><a class="message-link" name="4778825" parent="0" thread="4778825" href="/Messages/4778825/My-vote-of.aspx">My vote of 5</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Hassan Oumar Mahamat</span><span class="date">14-Mar-14  0:08</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-pro-16.png" title="professional" alt="professional" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=7205335">Hassan Oumar Mahamat</a></span></td><td class="date"><span>14-Mar-14  0:08 </span></td>
</tr>
</table></td>
</tr><tr id="F4778825_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="7205335" msgid="4778825" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Nice work!<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4778825" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4778825" data-ref="3_4778825" class="rating-label" name="RateItem_4778825"><span class="rating-result"><span></span></span></span><a href="/Messages/4778825/My-vote-of.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4769961_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4769961xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4769961" parent="0" thread="4769961" href="/Messages/4769961/Performance-of-STP-vs-NET-ThreadPool.aspx">Performance of STP vs .NET4.0 ThreadPool</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">AnandChavali</span><span class="date">1-Mar-14  6:44</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=3459491">AnandChavali</a></span></td><td class="date"><span>1-Mar-14  6:44 </span></td>
</tr>
</table></td>
</tr><tr id="F4769961_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="3459491" msgid="4769961" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">I heard and have personally seen improvements in .NET4.0 ThreadPool vs .NET2.0.<br />
I am now embarking to TPL. So just wondering should I just stick to DefaultTaskScheduler or<br />
Should I create a custom one based on STP.<br />
<br />
So any perf measurements of STP vs .NET4.0 ThreadPool would be great help...<br />
And your view on creating a custom task scheduler using STP<br />
<div class="signature">Thanks and Regards,<br />
Anand.</div><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4769961" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4769961" data-ref="3_4769961" class="rating-label" name="RateItem_4769961"><span class="rating-result"><span></span></span></span><a href="/Messages/4769961/Performance-of-STP-vs-NET-ThreadPool.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4763218_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4763218xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4763218" parent="0" thread="4763218" href="/Messages/4763218/Rebuild-NuGet-package-with-AllowPartiallyTrustedCa.aspx">Rebuild NuGet package with AllowPartiallyTrustedCallers?</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">E.J. Meijer</span><span class="date">19-Feb-14  21:28</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=3842570">E.J. Meijer</a></span></td><td class="date"><span>19-Feb-14  21:28 </span></td>
</tr>
</table></td>
</tr><tr id="F4763218_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="3842570" msgid="4763218" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hello,<br />
<br />
Would it be possible to rebuild the <a href="http://www.nuget.org/packages/SmartThreadPool.dll/">NuGet</a> package with the AllowPartiallyTrustedCallers attribute on the assembly?<br />
<br />
Please also see <a href="http://www.codeproject.com/Messages/4371107/Re-New-version-not-compatible-with-Medium-Trust.aspx">http://www.codeproject.com/Messages/4371107/Re-New-version-not-compatible-with-Medium-Trust.aspx</a><br />
<br />
SmartThreadPool only works with this attribute at my web hosting company with medium trust.<br />
<br />
I used to add the project myself to my solution, but I would like to switch to NuGet packages.<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4763218" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4763218" data-ref="3_4763218" class="rating-label" name="RateItem_4763218"><span class="rating-result"><span></span></span></span><a href="/Messages/4763218/Rebuild-NuGet-package-with-AllowPartiallyTrustedCa.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4757147_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4757147xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_bug.gif" alt="Bug" title="Bug" /></td><td class="subject hover-container"><a class="message-link" name="4757147" parent="0" thread="4757147" href="/Messages/4757147/Got-KeyNotFoundException.aspx">Got KeyNotFoundException</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">sukinsky</span><span class="date">11-Feb-14  21:12</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=10151706">sukinsky</a></span></td><td class="date"><span>11-Feb-14  21:12 </span></td>
</tr>
</table></td>
</tr><tr id="F4757147_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="10151706" msgid="4757147" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hello Ami,<br />
<br />
First thanks for STP.<br />
I'm using version 2.2.3 with multiple instances of STP simultaneously. My app was working for days but suddenly I got an exception:<br />
<pre lang="text">System.Collections.Generic.KeyNotFoundException
System.Collections.Generic.Dictionary`2[[System.__Canon],[System.__Canon]].get_Item(System.__Canon)
at Amib.Threading.Internal.SynchronizedDictionary`2[[System.__Canon],[System.__Canon].get_Item(System.__Canon)
at Amib.Threading.SmartThreadPool.<b>ProcessQueuedItems()</b>
at System.Threading.ThreadHelper.ThreadStart_Context(System.Object)
at System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object, Boolean)
at System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object, Boolean)
at System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)
at System.Threading.ThreadHelper.ThreadStart()</pre><br />
The only place there it can be thrown is the beginning of ProcessQueuedItems():<br />
<pre lang="text">CurrentThreadEntry = _workerThreads[Thread.CurrentThread];</pre><br />
Race condition can be here.<br />
<br />
UPD: Issue is resolved in STP's fork <a href="https://github.com/mlabs-pl/stp/commit/058b156c4d1631645ca7b00d95c411bbda0ace82">here</a><br /><br /><div class="modified">modified  12-Feb-14 4:46am.</div><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4757147" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4757147" data-ref="3_4757147" class="rating-label" name="RateItem_4757147"><span class="rating-result"><span></span></span></span><a href="/Messages/4757147/Got-KeyNotFoundException.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4690909_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4690909xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4690909" parent="0" thread="4690909" href="/Messages/4690909/Block-on-Enqueue-if-no-more-workers-can-be-created.aspx">Block on Enqueue if no more workers can be created</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">GoodFun</span><span class="date">30-Oct-13  7:41</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=1576625">GoodFun</a></span></td><td class="date"><span>30-Oct-13  7:41 </span></td>
</tr>
</table></td>
</tr><tr id="F4690909_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="1576625" msgid="4690909" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hi there,<br />
<br />
I was wondering if there is a way in STP to prevent items to be queued past the MaxWorkerThreads limit...<br />
My work items contain very heavy objects and I need fine grained control over how many items can be queued up.  I wrote a Queue that allows me to control this... but as I feed the items into STP, items just get queued into STP which defeats the purpose...<br />
<br />
Does the ability to either limit the queue size in STP or prevent queueing all together already exist in STP?<br />
<br />
Thank you for this great component... your work is very much appreciated.<br /><br /><div class="modified">modified  30-Oct-13 13:49pm.</div><br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4690909" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4690909" data-ref="3_4690909" class="rating-label" name="RateItem_4690909"><span class="rating-result"><span></span></span></span><a href="/Messages/4690909/Block-on-Enqueue-if-no-more-workers-can-be-created.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4679957_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4679957xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4679957" parent="0" thread="4679957" href="/Messages/4679957/setting-stpstartinfo-but-still-problem-with-sta.aspx">setting stpstartinfo, but still problem with sta</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">leos79</span><span class="date">14-Oct-13  18:30</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=7693107">leos79</a></span></td><td class="date"><span>14-Oct-13  18:30 </span></td>
</tr>
</table></td>
</tr><tr id="F4679957_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="7693107" msgid="4679957" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hi,<br />
<br />
I'm getting the STA error on waitall call. I've declared my pool like this:<br />
<br />
<pre lang="vb"><span class="code-keyword">Dim</span> stpStartInfo <span class="code-keyword">As</span> STPStartInfo
stpStartInfo = <span class="code-keyword">New</span> STPStartInfo()
stpStartInfo.ApartmentState = Threading.ApartmentState.MTA
t = <span class="code-keyword">New</span> SmartThreadPool(stpStartInfo)</pre><br />
<br />
<br />
Also, I've put this on the function i'm using the pool:<br />
<br />
<pre lang="vb"><MTAThread()> _
<span class="code-keyword">Friend</span> <span class="code-keyword">Function</span> MyFunction</pre><br />
<br />
<br />
What am I missing?<br />
<br />
Thank you!<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4679957" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4679957" data-ref="3_4679957" class="rating-label" name="RateItem_4679957"><span class="rating-result"><span></span></span></span><a href="/Messages/4679957/setting-stpstartinfo-but-still-problem-with-sta.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4680132_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="38px" class="indent"><a name="xx4680132xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_answer.gif" alt="Answer" title="Answer" /></td><td class="subject hover-container"><a class="message-link" name="4680132" parent="4679957" thread="4679957" href="/Messages/4680132/Re-setting-stpstartinfo-but-still-problem-with-sta.aspx">Re: setting stpstartinfo, but still problem with sta</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Ami Bar</span><span class="date">14-Oct-13  23:59</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=933414">Ami Bar</a></span></td><td class="date"><span>14-Oct-13  23:59 </span></td>
</tr>
</table></td>
</tr><tr id="F4680132_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="933414" msgid="4680132" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return forumControl36716156.SwitchMessage(null,4679957);" href="/Messages/4679957/setting-stpstartinfo-but-still-problem-with-sta.aspx"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/arrow-up24.png" title="Go to Parent"  style="width:16px;height:16px;border:0" /></a></div>You have to call the WaitAll from an MTA thread.<br />
<br />
Only the Main() method supports the MTAThread attribute, other threads should be set programmatically.<br />
<br />
Ami<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4679957" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4680132" data-ref="3_4680132" class="rating-label" name="RateItem_4680132"><span class="rating-result"><span></span></span></span><a href="/Messages/4680132/Re-setting-stpstartinfo-but-still-problem-with-sta.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4633114_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4633114xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_bug.gif" alt="Bug" title="Bug" /></td><td class="subject hover-container"><a class="message-link" name="4633114" parent="0" thread="4633114" href="/Messages/4633114/Cant-catch-error-of-yield-return.aspx">Can't catch error of  "yield return"</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">zero.do</span><span class="date">9-Aug-13  23:27</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=6491693">zero.do</a></span></td><td class="date"><span>9-Aug-13  23:27 </span></td>
</tr>
</table></td>
</tr><tr id="F4633114_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="6491693" msgid="4633114" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2"><pre lang="c#"><span class="code-keyword">private</span> <span class="code-keyword">void</span> button1_Click(<span class="code-keyword">object</span> sender, EventArgs e)
{
<span class="code-keyword">var</span> ire = pool.QueueWorkItem<int, IEnumerable<int>>(b =<span class="code-keyword">></span> test(b), <span class="code-digit">1</span>);
pool.Start();
<span class="code-keyword">if</span> (SmartThreadPool.WaitAll(<span class="code-keyword">new</span>[] { ire }))
{
Exception ex;
ire.GetResult(<span class="code-keyword">out</span> ex);
<span class="code-keyword">if</span> (ex != <span class="code-keyword">null</span>) MessageBox.Show(ex.Message);
}
}
IEnumerable<int> test(<span class="code-keyword">int</span>? b)
{
<span class="code-keyword">if</span> (b == <span class="code-digit">1</span>) <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Exception(<span class="code-string">"</span><span class="code-string">test error"</span>);
<span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = <span class="code-digit">0</span>; i <span class="code-keyword"><</span> <span class="code-digit">4</span>; i++)
{
<span class="code-keyword">yield</span> <span class="code-keyword">return</span> i;
}
}
</pre><br />
<br />
<br />
I knew "yield return" can't be used in try-catch block,If it means I can't use "yield" to return the result?<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4633114" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4633114" data-ref="3_4633114" class="rating-label" name="RateItem_4633114"><span class="rating-result"><span></span></span></span><a href="/Messages/4633114/Cant-catch-error-of-yield-return.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4626608_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4626608xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_bug.gif" alt="Bug" title="Bug" /></td><td class="subject hover-container"><a class="message-link" name="4626608" parent="0" thread="4626608" href="/Messages/4626608/Merge-a-fix.aspx">Merge a fix?</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">Hauk</span><span class="date">1-Aug-13  7:45</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=73234">Hauk</a></span></td><td class="date"><span>1-Aug-13  7:45 </span></td>
</tr>
</table></td>
</tr><tr id="F4626608_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="73234" msgid="4626608" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Hello!<br />
<br />
I just wanted to see if you could merge a fix for an issue reported on Github? I submitted a pull request a few months ago. See this link: <a href="https://github.com/amibar/SmartThreadPool/pull/7">https://github.com/amibar/SmartThreadPool/pull/7</a>[<a href="https://github.com/amibar/SmartThreadPool/pull/7" target="_blank" title="New Window">^</a>]<br />
<br />
Thanks for an awesome tool!<br />
/Hakan<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4626608" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4626608" data-ref="3_4626608" class="rating-label" name="RateItem_4626608"><span class="rating-result"><span></span></span></span><a href="/Messages/4626608/Merge-a-fix.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr id="F4578141_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="20px" class="indent"><a name="xx4578141xx"></a><img height="16px" width="16px" align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" alt="Question" title="Question" /></td><td class="subject hover-container"><a class="message-link" name="4578141" parent="0" thread="4578141" href="/Messages/4578141/Windows-CE.aspx">Windows CE...</a> <a onclick="return forumControl36716156.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px" /></a><div class="mobile-only">
<span class="author">JSThePatriot</span><span class="date">2-Jun-13  21:19</span>
</div></td><td class="icon"><img border="0" src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/icn-member-16.gif" title="member" alt="member" height="16px" /></td><td class="author"><span><a href="/script/Membership/View.aspx?mid=2560872">JSThePatriot</a></span></td><td class="date"><span>2-Jun-13  21:19 </span></td>
</tr>
</table></td>
</tr><tr id="F4578141_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="2560872" msgid="4578141" votingType="GoodOrBad"></span></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2">Ami,<br />
<br />
I'm looking to try STP and need to use it specifically on Windows CE. I'm interested in what isn't working and if I need what's not working...<br />
<br />
I see that it works in a limited capacity on Windows CE. I will be implementing STP into my project tomorrow. I look forward to your response.<br />
<br />
Thanks,<br />
Jarvis<br /></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/7933/Smart-Thread-Pool">Sign In</a>·<wbr><a href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&tid=4578141" title="View Thread">View Thread</a></td><td style="text-align:right;"><span id="MVF4578141" data-ref="3_4578141" class="rating-label" name="RateItem_4578141"><span class="rating-result"><span></span></span></span><a href="/Messages/4578141/Windows-CE.aspx" title="Get permanent link" style="border:0 !important"><img src="https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/link32.png" style="width:14px;height:14px;border:0" /></a> </td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr>
</table></td>
</tr><tr>
<td><table width="100%" cellpadding="2px" cellspacing="0">
<tr class="footer">
<td><span class="last-visit desktop-only tablet-only">Last Visit: 31-Dec-99  18:00     Last Update: 27-Jun-18  1:19</span></td><td><a rel="nofollow" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal">Refresh</a></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link selected">1</span><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=26#xx0xx">2</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=51#xx0xx">3</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=76#xx0xx">4</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=101#xx0xx">5</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=126#xx0xx">6</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=151#xx0xx">7</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=176#xx0xx">8</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=201#xx0xx">9</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=226#xx0xx">10</a><a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=251#xx0xx">11</a> <a class="nav-link" name="Frm_HoverNL" href="/Articles/7933/Smart-Thread-Pool?fid=88599&df=90&mpp=25&sort=Position&spc=Relaxed&prof=True&view=Normal&fr=26#xx0xx">Next »</a></td>
</tr>
</table></td>
</tr>
</table>
</div><p class="small-text"><img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_general.gif" width="16px" height="16px" alt="General" /> General    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_news.gif" width="16px" height="16px" alt="News" /> News    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_idea.gif" width="16px" height="16px" alt="Suggestion" /> Suggestion    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_question.gif" width="16px" height="16px" alt="Question" /> Question    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_bug.gif" width="16px" height="16px" alt="Bug" /> Bug    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_answer.gif" width="16px" height="16px" alt="Answer" /> Answer    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_joke.gif" width="16px" height="16px" alt="Joke" /> Joke    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_kudos.gif" width="16px" height="16px" alt="Praise" /> Praise    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_rant.gif" width="16px" height="16px" alt="Rant" /> Rant    <img align="top" src="https://codeproject.global.ssl.fastly.net/script/Forums/Images/msg_admin.gif" width="16px" height="16px" alt="Admin" /> Admin    </p><p class="small-text">Use Ctrl+Left/Right to switch messages, Ctrl+Up/Down to switch threads, Ctrl+Shift+Left/Right to switch pages.</p>
</div>
</td>
<td width="170px" class="article-wing-right">
<div id="ctl00_RightSideBar" class="container-article-info">
<div id="RHSticky" class="container-article-info-sticky">
<div class="article-summary">
</div>
<div id="ctl00_SectionSponsor" class="padded-top" style="width:160px;margin:auto 10px">
<div class="msg-160x200" data-format="160x200" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Thread-Pooling"  data-tags='.NET2.0, WinXP, Win2003, VS2005, Mono, .NET3.0, .NET3.5, VS2008, C#, Windows, .NET, Visual-Studio, Dev, Intermediate, Win2008, Win7, VS2010, Win2008-R2, threads, .NET4,rating4.5'></div>
</div>
<div style="width:160px;margin: 10px auto;">
<div class="msg-160x600" data-format="160x600" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Thread-Pooling"  data-tags='.NET2.0, WinXP, Win2003, VS2005, Mono, .NET3.0, .NET3.5, VS2008, C#, Windows, .NET, Visual-Studio, Dev, Intermediate, Win2008, Win7, VS2010, Win2008-R2, threads, .NET4,rating4.5'></div>
</div>
<div class="anchorLink gototop" id="gototop">
<a id="ctl00_GoToTop" href="/Articles/7933/Smart-Thread-Pool#_articleTop">Go to top</a>
</div>
</div>
</div>
</td>
</tr></table>
<div class="theme1-background" style="height:2px" id="stickyStop"></div>
<div class="extended tiny-text">
<div class="row">
<div class="float-left">
<a id="ctl00_PermaLink" href="/Articles/7933/Smart-Thread-Pool">Permalink</a> |
<a id="ctl00_AdvertiseLink" href="http://developermedia.com/">Advertise </a> |
<a id="ctl00_PrivacyLink" href="/info/privacy.aspx">Privacy</a> |
<a id="ctl00_CookiePolicyLink" href="/info/cookies.aspx">Cookies</a> |
<a id="ctl00_TermsOfUseLink" href="/info/TermsOfUse.aspx">Terms of Use</a> |
<a id="ctl00_Mobile">Mobile</a>
<br />
Web02-2016 |
2.8.180621.3 |
Last Updated 27 Aug 2012
</div>
<div id="ctl00_GoogleTranslate" class="translate float-left"></div>
<div class="float-right align-right">
Article Copyright 2004 by Ami Bar<br />Everything else
Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2018 <br />
</div>
<div class="page-width">
Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="/Articles/7933/Smart-Thread-Pool?PageFlow=FixedWidth">fixed</a>
|
<a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="/Articles/7933/Smart-Thread-Pool?PageFlow=Fluid">fluid</a>
</div>
</div>
</div>
<br clear="all" />
</div>
</div>
</div>
<img id="ctl00_Audience" src="https://pubads.g.doubleclick.net/activity;dc_iu=/6839/DFPAudiencePixel;ord='636656807862737815';dc_seg=33704410?" style="border-width:0px;height:1px;width:1px;" /><script type="text/javascript"> 
var url = 'https://www.codeproject.com/Articles/7933/Smart-Thread-Pool#SimpleExample';
var au = url.split('/');
var domain = au[0] + '//' + au[2];

var dels = [], a = [];

var h1s = document.getElementsByTagName('h1');
if (h1s.length == 0) h1s = document.getElementsByTagName('h2');

if (h1s.length > 0) {
    var it = h1s[h1s.length - 1].parentNode;
    while (it.parentNode.tagName != 'BODY') {
        it = it.parentNode;
    }

    dels = [], a = [];
    a = document.body.childNodes;
    for (var i = 0; i < a.length; i++)
        if (a[i] != it) dels.push(a[i]);
    for (var i = 0; i < dels.length; i++)
        if (dels[i] != null && dels[i].parentNode != null) dels[i].parentNode.removeChild(dels[i]);
}

a = document.body.getElementsByTagName('*');
for (var i = 0; i < a.length; i++) {
    if (a[i].hasAttribute('style')) a[i].removeAttribute('style');
    if (a[i].tagName == 'PRE') continue;
    if (a[i].tagName == 'CODE') {
        var code = a[i].innerHTML;
        code = code.split('<').join('&lt;').split('>').join('&gt;');
        a[i].innerHTML = code;
        //console.log(code);
    } else {
        if (is_remove_text(a[i].textContent) || is_remove_id(a[i].id) || is_remove_css(a[i].className)) dels.push(a[i]);
    }
}
for (var i = 0; i < dels.length; i++)
    if (dels[i] != null && dels[i].parentNode != null && dels[i].tagName != 'IMG') {
        if (dels[i].getElementsByTagName('img').length > 0) continue; 
        dels[i].parentNode.removeChild(dels[i]);
    }


a = document.body.getElementsByTagName('img');
for (var i = 0; i < a.length; i++) {
    if (a[i].src != null) {
        var src = a[i].getAttribute('src');
        if (src[0] == '/') {
            src = domain + src;
            a[i].setAttribute('src', src);
        }
    }
}

function is_remove_text(s) {
    if (s == null || s.trim().length == 0) return true;
    s = s.toLowerCase().trim();
    return s == 'read more'
        || s == 'see more'
        || s == 'further reading'
        || s == 'log in'
        || s == 'ad'
        || s.indexOf('sign in') == 0
        || s.indexOf('sign up') == 0
        || s.indexOf('copyright ') == 0
}

function is_remove_id(s) {
    if (s == null || s.trim().length == 0) return false;
    s = s.toLowerCase();
    return s.indexOf('search') != -1
        //|| s.indexOf('header') != -1
        //|| s.indexOf('footer') != -1
        //|| s.indexOf('sidebar') != -1
        || s.indexOf('login') != -1
        || s.indexOf('cookie') != -1
        || s.indexOf('newsletter') != -1
        || s.indexOf('breadcrumb') != -1
        || s.indexOf('metadata') != -1
        || s.indexOf('feedback') != -1
        || s.indexOf('user-info') != -1
        || s.indexOf('post-menu') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('nav-') != -1
        || s.indexOf('adbanner') != -1
        || s.indexOf('error') != -1
        || s.indexOf('navigation-') != -1
        || s.indexOf('page-action') == 0
        || s.indexOf('pageaction') == 0
        || s.indexOf('memberbar') != -1
        || s == 'sidebar'

        || s.indexOf('comments-link-') == 0
}

function is_remove_css(s) {
    if (s == null || s.trim().length == 0) return false;
    s = s.toLowerCase();
    return s.indexOf('hide') != -1
        || s.indexOf('search') != -1
        //|| s.indexOf('header') != -1
        //|| s.indexOf('footer') != -1
        //|| s.indexOf('sidebar') != -1
        || s.indexOf('cookie') != -1
        || s.indexOf('newsletter') != -1
        || s.indexOf('breadcrumb') != -1
        || s.indexOf('metadata') != -1
        || s.indexOf('feedback') != -1
        || s.indexOf('user-info') != -1
        || s.indexOf('post-menu') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('share-') != -1
        || s.indexOf('nav-') != -1
        || s.indexOf('navbar') != -1
        || s.indexOf('adbanner') != -1
        || s.indexOf('error') != -1

        || s.indexOf('page-action') == 0
        || s.indexOf('pageaction') == 0
        || s.indexOf('memberbar') != -1

        || s.indexOf('rating') != -1
        || s.indexOf('social') != -1

        /*stackoverflow.com*/
        || s.indexOf('answers-subheader') != -1
        //|| s == 'vote'
        || s == 'vote-up-off'
        || s == 'vote-down-off'
        || s == 'bottom-notice'
        || s == 'question-status'
        || s == 'post-taglist'
        || s == 'comment-score'
        || s.indexOf('comment-user') != -1 
        || s.indexOf('vote-accepted') != -1 

        /*github.com*/
        || s.indexOf('signup-') != -1 
}   </script>